# Databricks Asset Bundle Configuration
# DatabricksHealthMonitor - System Tables Medallion Architecture
#
# Organization:
#   - Bronze: Raw streaming ingestion from system tables (32 tables)
#   - Gold: Business-level dimensional model (38 tables)
#
# NOTE: Schemas are created in setup scripts (not as bundle resources) 
#       to avoid dev mode automatic prefixing

bundle:
  name: databricks_health_monitor

sync:
  include:
    - src/**/*.py
    - src/**/*.sql
    - src/**/*.yaml
    - src/**/*.json
    - src/**/*.md
    - gold_layer_design/yaml/**/*.yaml

variables:
  catalog:
    description: Unity Catalog name for system tables
    default: prashanth_subrahmanyam_catalog
  
  system_bronze_schema:
    description: Schema name for system tables Bronze layer
    default: system_bronze
  
  system_silver_schema:
    description: Schema name for system tables Silver layer
    default: system_silver
  
  gold_schema:
    description: Schema name for Gold layer (system tables dimensional model)
    default: system_gold
  
  feature_schema:
    description: Schema name for ML Feature Store tables and predictions
    default: system_gold_ml
  
  # Agent Framework Schema (consolidated - avoids schema sprawl)
  # Contains: Models, Tables (structured), Volumes (unstructured), Inference Logs, Memory
  agent_schema:
    description: Schema for Agent models, inference logs, memory, and all agent data
    default: system_gold_agent
  
  agent_model_version:
    description: Model version to deploy to serving endpoint (workspace-specific)
    default: "1"  # Default to version 1 for new workspaces
  
  warehouse_id:
    description: SQL Warehouse ID for serverless execution
    default: "4b9b953939869799"
  
  node_type_id:
    description: Node type for agent clusters (used by agent_deployment.yml)
    default: "i3.xlarge"
  
  lakebase_instance_name:
    description: Lakebase instance name for agent memory (shared workspace instance)
    default: "DONOTDELETE-vibe-coding-workshop-lakebase"
  
  llm_endpoint:
    description: LLM endpoint for agent inference (used by agent_deployment.yml)
    default: "databricks-claude-sonnet-4-5"
  
  dashboard_folder:
    description: Workspace folder path where dashboards will be published
    default: "/Shared/health_monitor/dashboards"
  
  # Genie Space IDs (Single Source of Truth for deployment)
  # These override the defaults in src/agents/config/genie_spaces.py
  cost_genie_space_id:
    description: Health Monitor Cost Intelligence Space
    default: "01f0f1a3c2dc1c8897de11d27ca2cb6f"
  
  reliability_genie_space_id:
    description: Health Monitor Job Reliability Space
    default: "01f0f1a3c33b19848c856518eac91dee"
  
  quality_genie_space_id:
    description: Health Monitor Data Quality Space
    default: "01f0f1a3c39517ffbe190f38956d8dd1"
  
  performance_genie_space_id:
    description: Health Monitor Performance Space
    default: "01f0f1a3c3e31a8e8e6dee3eddf5d61f"
  
  security_genie_space_id:
    description: Health Monitor Security Auditor Space
    default: "01f0f1a3c44117acada010638189392f"
  
  unified_genie_space_id:
    description: Databricks Health Monitor Space
    default: "01f0f1a3c4981080b61e224ecd465817"

targets:
  dev:
    mode: development
    default: true
    workspace:
      host: https://e2-demo-field-eng.cloud.databricks.com/
    variables:
      catalog: prashanth_subrahmanyam_catalog
      system_bronze_schema: dev_${workspace.current_user.short_name}_system_bronze
      system_silver_schema: dev_${workspace.current_user.short_name}_system_silver
      gold_schema: dev_${workspace.current_user.short_name}_system_gold
      feature_schema: dev_${workspace.current_user.short_name}_system_gold_ml
      agent_schema: dev_${workspace.current_user.short_name}_system_gold_agent
      agent_model_version: "87"  # Current dev version with OBO
      warehouse_id: "4b9b953939869799"
      
  prod:
    mode: production
    variables:
      catalog: main
      system_bronze_schema: system_bronze
      system_silver_schema: system_silver
      gold_schema: system_gold
      feature_schema: system_gold_ml
      agent_schema: system_gold_agent
      warehouse_id: "4b9b953939869799"

# Include all resource definitions organized by layer and function
include:
  # Data Pipelines (Medallion Architecture)
  - resources/pipelines/bronze/*.yml
  - resources/pipelines/silver/*.yml
  - resources/pipelines/gold/*.yml
  
  # Orchestrators (Master Setup/Refresh)
  - resources/orchestrators/*.yml
  
  # Alerting Framework (SQL Alerts)
  - resources/alerting/*.yml
  
  # Machine Learning
  - resources/ml/*.yml
  
  # Semantic Layer (TVFs, Metric Views)
  - resources/semantic/*.yml
  
  # Genie Spaces
  - resources/genie/*.yml
  
  # Lakehouse Monitoring
  - resources/monitoring/*.yml
  
  # AI/BI Dashboards
  - resources/dashboards/*.yml
  
  # Agent Framework
  - resources/agents/*.yml

