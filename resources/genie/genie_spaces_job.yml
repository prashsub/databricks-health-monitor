# â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
# GENIE SPACES DEPLOYMENT JOB
# â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
#
# Deploys 6 Databricks Health Monitor Genie Spaces programmatically via the 
# Genie Space Export/Import REST API.
#
# âš ï¸ PREREQUISITE: Run genie_benchmark_sql_validation_job FIRST to validate
#                  all benchmark SQL queries before deploying!
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# GENIE SPACES DEPLOYED (6 Spaces)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
#   1. ğŸ’° Cost Intelligence Genie Space
#      - File: cost_intelligence_genie_export.json
#      - TVFs: 15 cost functions | ML: 6 models | Queries: 25
#
#   2. ğŸ“Š Data Quality Monitor Genie Space
#      - File: data_quality_monitor_genie_export.json
#      - TVFs: 5 quality functions | ML: 2 models | Queries: 20
#
#   3. ğŸ”„ Job Health Monitor Genie Space
#      - File: job_health_monitor_genie_export.json
#      - TVFs: 12 reliability functions | ML: 5 models | Queries: 25
#
#   4. âš¡ Performance Genie Space
#      - File: performance_genie_export.json
#      - TVFs: 21 performance functions | ML: 7 models | Queries: 25
#
#   5. ğŸ” Security Auditor Genie Space
#      - File: security_auditor_genie_export.json
#      - TVFs: 10 security functions | ML: 4 models | Queries: 25
#
#   6. ğŸ¥ Unified Health Monitor Genie Space
#      - File: unified_health_monitor_genie_export.json
#      - TVFs: 60 cross-domain functions | ML: 5 models | Queries: 25
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# API INTEGRATION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# Genie Space Export/Import API Endpoints:
#   - POST   /api/2.0/genie/spaces           - Create new Genie Space
#   - PATCH  /api/2.0/genie/spaces/{id}      - Update existing Space
#   - GET    /api/2.0/genie/spaces/{id}      - Get Space details
#   - DELETE /api/2.0/genie/spaces/{id}      - Delete Space
#
# Export/Import Format:
#   - JSON schema v1 (Databricks Genie Space Export format)
#   - Includes: config, data_sources, instructions, benchmarks
#   - Variable substitution: ${catalog}, ${gold_schema}, ${feature_schema}
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# DEPLOYMENT WORKFLOW
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# Prerequisites:
#   1. Run genie_benchmark_sql_validation_job to validate SQL queries âœ…
#   2. Ensure semantic layer assets exist (TVFs, Metric Views, ML Models) âœ…
#   3. Verify UC permissions for Genie API access âœ…
#
# Deployment Steps: â±ï¸ ~2-3 minutes
#   â”œâ”€ Load all 6 JSON export files
#   â”œâ”€ Substitute catalog/schema variables
#   â”œâ”€ Check if Genie Space exists (GET)
#   â”œâ”€ Create new Space (POST) or Update existing (PATCH)
#   â”œâ”€ Configure permissions and access
#   â”œâ”€ Verify deployment success
#   â””â”€ Log deployment status
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# REFERENCES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# Official Documentation:
#   - Genie Space API: https://docs.databricks.com/api/workspace/genie/createspace
#   - Export/Import API: cursor rules/semantic-layer/29-genie-space-export-import-api.mdc
#
# Project Documentation:
#   - Deployment Guide: docs/deployment/GENIE_SPACES_DEPLOYMENT_GUIDE.md
#   - Validation Report: docs/reference/genie-fixes-complete-report.md
#   - Asset Inventory: docs/actual_assets.md
#
# â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

resources:
  jobs:
    genie_spaces_deployment_job:
      name: "[${bundle.target}] Health Monitor - Genie Spaces Deployment"
      description: "Validates benchmark SQL and deploys Genie Spaces from JSON export files"

      # Serverless environment
      environments:
        - environment_key: default
          spec:
            environment_version: "4"

      tasks:
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        # GENIE SPACE DEPLOYMENT TASK â±ï¸ ~2-3 min
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        # 
        # Deploys Genie Spaces via REST API:
        #   âœ… Reads 6 JSON export files from src/genie/ directory
        #   âœ… Substitutes catalog/schema variables in JSON
        #   âœ… Checks if Genie Space exists (GET /api/2.0/genie/spaces/{id})
        #   âœ… Creates new (POST) or updates existing (PATCH)
        #   âœ… Configures space permissions and access
        #   âœ… Verifies deployment success
        #
        # âš ï¸ PREREQUISITE: Run genie_benchmark_sql_validation_job FIRST!
        #
        # Deployment Order (sequential, not parallel):
        #   1. Cost Intelligence Genie Space
        #   2. Data Quality Monitor Genie Space
        #   3. Job Health Monitor Genie Space
        #   4. Performance Genie Space
        #   5. Security Auditor Genie Space
        #   6. Unified Health Monitor Genie Space
        #
        # Output: Deployment status for each Genie Space
        # Duration: ~2-3 minutes (6 spaces Ã— ~20-30 seconds each)
        #
        - task_key: deploy_genie_spaces
          description: "ğŸš€ Deploy all 6 Genie Spaces from JSON export files"
          environment_key: default
          notebook_task:
            notebook_path: ../../src/genie/deploy_genie_space.py
            base_parameters:
              catalog: ${var.catalog}
              gold_schema: ${var.gold_schema}
              feature_schema: ${var.feature_schema}
              warehouse_id: ${var.warehouse_id}
              genie_space_json: ""  # Empty = deploy all *_export.json files
              # Genie Space IDs from databricks.yml (override defaults in genie_spaces.py)
              cost_genie_space_id: ${var.cost_genie_space_id}
              reliability_genie_space_id: ${var.reliability_genie_space_id}
              quality_genie_space_id: ${var.quality_genie_space_id}
              performance_genie_space_id: ${var.performance_genie_space_id}
              security_genie_space_id: ${var.security_genie_space_id}
              unified_genie_space_id: ${var.unified_genie_space_id}
          
          # Timeout: 10 minutes (allows time for 6 Genie Space deployments)
          timeout_seconds: 600

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # JOB SCHEDULING & MONITORING
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      # Schedule: Run on-demand (not scheduled)
      # Trigger: Manually after semantic layer deployment and SQL validation
      # Typical Flow:
      #   1. Deploy TVFs, Metric Views, ML Models (semantic layer)
      #   2. Run genie_benchmark_sql_validation_job to validate SQL queries âœ…
      #   3. Run THIS JOB to deploy Genie Spaces
      #   4. Share Genie Spaces with users

      # Timeout at job level: 10 minutes (deployment only, no validation)
      timeout_seconds: 600

      # Max concurrent runs: 1 (prevent concurrent deployments)
      max_concurrent_runs: 1

      # Tags for cost tracking and governance
      tags:
        environment: ${bundle.target}
        project: health_monitor
        layer: semantic
        artifact_type: genie_space
        job_type: deployment
        deployment_method: rest_api
        genie_space_count: "6"
        api_version: "v1"
        prerequisite_job: genie_benchmark_sql_validation_job
      
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # JOB PERMISSIONS (inherited from bundle default)
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•



