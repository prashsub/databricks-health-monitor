# â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
# GENIE SPACES - BENCHMARK SQL VALIDATION JOB
# â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
#
# Standalone job to validate ALL 200+ benchmark SQL queries across 6 Genie Spaces
# before deployment. This can be run independently during development/testing.
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# WHAT IT VALIDATES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
#   âœ… SQL syntax correctness
#   âœ… Column resolution (columns exist in referenced tables/views)
#   âœ… Table/view/function existence (TVFs, Metric Views, ML Tables)
#   âœ… Function signatures (correct parameter types and counts)
#   âœ… No ambiguous column references
#   âœ… No type mismatches
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# VALIDATION METHOD
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
#   - Uses EXPLAIN for each query (validates without data access)
#   - Catches errors BEFORE deployment (fail-fast approach)
#   - Prints detailed error logs to stdout for troubleshooting
#   - Job FAILS if any query errors are found
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# GENIE SPACES VALIDATED (150 queries - 25 per space)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
#   1. ğŸ’° Cost Intelligence (25 queries)
#   2. ğŸ“Š Data Quality Monitor (25 queries)
#   3. ğŸ”„ Job Health Monitor (25 queries)
#   4. âš¡ Performance (25 queries)
#   5. ğŸ” Security Auditor (25 queries)
#   6. ğŸ¥ Unified Health Monitor (25 queries)
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# USAGE
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# Run validation independently:
#   databricks bundle run -t dev genie_benchmark_sql_validation_job
#
# Expected Duration: ~5-10 minutes (200+ queries Ã— ~2-3 seconds each)
#
# Output:
#   - Detailed validation report in job logs
#   - Error categorization by Genie Space and error type
#   - Troubleshooting guidance for each error type
#   - Exit code 0 = all queries valid, Exit code 1 = errors found
#
# â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

resources:
  jobs:
    genie_benchmark_sql_validation_job:
      name: "[${bundle.target}] Health Monitor - Genie SQL Validation"
      description: "EXECUTES 150+ benchmark SQL queries with LIMIT 1 across 6 Genie Spaces"

      # Serverless environment
      environments:
        - environment_key: default
          spec:
            environment_version: "4"

      tasks:
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        # PARALLEL VALIDATION TASKS (One per Genie Space)
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        # Each task validates only its assigned Genie Space JSON file
        # All tasks run in parallel for faster validation (5x speedup)
        # Individual pass/fail rates visible per space
        
        - task_key: validate_cost_intelligence
          description: "ğŸ’° Cost Intelligence (25 queries)"
          environment_key: default
          notebook_task:
            notebook_path: ../../src/genie/validate_genie_spaces_notebook.py
            base_parameters:
              catalog: ${var.catalog}
              gold_schema: ${var.gold_schema}
              feature_schema: ${var.feature_schema}
              genie_space_filter: cost_intelligence_genie_export.json
        
        - task_key: validate_performance
          description: "âš¡ Performance (25 queries)"
          environment_key: default
          notebook_task:
            notebook_path: ../../src/genie/validate_genie_spaces_notebook.py
            base_parameters:
              catalog: ${var.catalog}
              gold_schema: ${var.gold_schema}
              feature_schema: ${var.feature_schema}
              genie_space_filter: performance_genie_export.json
        
        - task_key: validate_data_quality_monitor
          description: "ğŸ“Š Data Quality Monitor (25 queries)"
          environment_key: default
          notebook_task:
            notebook_path: ../../src/genie/validate_genie_spaces_notebook.py
            base_parameters:
              catalog: ${var.catalog}
              gold_schema: ${var.gold_schema}
              feature_schema: ${var.feature_schema}
              genie_space_filter: data_quality_monitor_genie_export.json
        
        - task_key: validate_job_health_monitor
          description: "ğŸ”„ Job Health Monitor (25 queries)"
          environment_key: default
          notebook_task:
            notebook_path: ../../src/genie/validate_genie_spaces_notebook.py
            base_parameters:
              catalog: ${var.catalog}
              gold_schema: ${var.gold_schema}
              feature_schema: ${var.feature_schema}
              genie_space_filter: job_health_monitor_genie_export.json
        
        - task_key: validate_security_auditor
          description: "ğŸ” Security Auditor (25 queries)"
          environment_key: default
          notebook_task:
            notebook_path: ../../src/genie/validate_genie_spaces_notebook.py
            base_parameters:
              catalog: ${var.catalog}
              gold_schema: ${var.gold_schema}
              feature_schema: ${var.feature_schema}
              genie_space_filter: security_auditor_genie_export.json
        
        - task_key: validate_unified_health_monitor
          description: "ğŸ¥ Unified Health Monitor (25 queries)"
          environment_key: default
          notebook_task:
            notebook_path: ../../src/genie/validate_genie_spaces_notebook.py
            base_parameters:
              catalog: ${var.catalog}
              gold_schema: ${var.gold_schema}
              feature_schema: ${var.feature_schema}
              genie_space_filter: unified_health_monitor_genie_export.json

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # JOB CONFIGURATION
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      # No schedule - run on-demand for validation
      # Typical workflow:
      #   1. Update Genie Space JSON files
      #   2. Run validation to catch SQL errors
      #   3. Fix any errors found
      #   4. Re-run validation until clean
      #   5. Deploy Genie Spaces (separate job)

      # Email notifications
      email_notifications:
        on_failure:
          - data-engineering@company.com
        on_success:
          - data-engineering@company.com

      # Timeout at job level (1 hour - 123 queries Ã— ~8 sec + cold start + buffer)
      timeout_seconds: 3600

      # Tags
      tags:
        environment: ${bundle.target}
        project: health_monitor
        layer: semantic
        artifact_type: genie_space
        job_type: validation
        validation_method: sql_execution
        genie_space_count: "6"
        benchmark_query_count: "200+"
        fail_fast: "true"
      
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # REFERENCES
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # Validation Script: src/genie/validate_genie_spaces_notebook.py
      # Genie Space Files: src/genie/*_genie_export.json
      # Asset Inventory: docs/actual_assets.md

