# Genie Space Deployment Job
# Deploys all Genie Spaces for Health Monitor
#
# Genie Spaces created:
#   - Cost Intelligence: FinOps and cost analysis
#   - Job Health Monitor: Job reliability monitoring
#   - Query Performance: SQL performance analysis
#   - Cluster Optimizer: Resource utilization analysis
#   - Security Auditor: Access and compliance monitoring
#   - Health Monitor (Unified): Comprehensive platform health
#
# Run after Gold layer, TVFs, and Metric Views are deployed
# Reference: https://docs.databricks.com/genie

resources:
  jobs:
    genie_space_deployment_job:
      name: "[${bundle.target}] Health Monitor - Genie Space Deployment"
      description: "Deploys all Genie Spaces for natural language analytics"

      tasks:
        - task_key: deploy_all_genie_spaces
          notebook_task:
            notebook_path: ../../src/semantic/genie/deploy_genie_spaces.py
            base_parameters:
              catalog: ${var.catalog}
              gold_schema: ${var.gold_schema}
              warehouse_id: ${var.warehouse_id}

      # No schedule - run on demand after Gold setup
      # Genie Spaces are static configurations

      # Timeout: 15 minutes
      timeout_seconds: 900

      # Email notifications
      email_notifications:
        on_failure:
          - data-engineering@company.com

      tags:
        environment: ${bundle.target}
        project: health_monitor
        layer: presentation
        job_type: deployment
        artifact_type: genie_space
        compute_type: serverless
