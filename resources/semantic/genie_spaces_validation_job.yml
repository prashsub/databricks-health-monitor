# Genie Spaces Pre-Deployment Validation Job
# Validates JSON export files before deployment
#
# Checks:
#   - JSON structure completeness
#   - Sorting requirements (tables, metric_views, column_configs)
#   - SQL benchmark question syntax
#   - MEASURE() function usage
#   - Table/function references
#   - Variable substitution patterns
#
# Run this BEFORE genie_spaces_deployment_job

resources:
  jobs:
    genie_spaces_validation_job:
      name: "[${bundle.target}] Health Monitor - Genie Spaces Validation"
      description: "Pre-deployment validation of Genie Space JSON exports (structure, sorting, SQL syntax)"
      
      # Serverless environment
      environments:
        - environment_key: default
          spec:
            environment_version: "4"
      
      tasks:
        - task_key: validate_genie_spaces
          environment_key: default
          notebook_task:
            notebook_path: ../../src/genie/validate_genie_spaces_notebook.py
      
      # Email notifications on failure
      email_notifications:
        on_failure:
          - prashanth.subrahmanyam@databricks.com
      
      # Tags
      tags:
        environment: ${bundle.target}
        project: databricks_health_monitor
        layer: semantic
        job_type: validation
        compute_type: serverless

