# Alerting Seed Job (Atomic)
# ==========================
#
# Populates the alert_configurations table with all planned alerts from:
# plans/phase3-addendum-3.7-alerting-framework.md
#
# Alert Categories:
# - COST (18 alerts): Cost management, budget, commit tracking, tag hygiene
# - SECURITY (8 alerts): Access control, audit, anomaly detection
# - PERFORMANCE (12 alerts): Query performance, warehouse utilization
# - RELIABILITY (10 alerts): Job reliability, SLA, cluster health
# - QUALITY (6 alerts): Data quality, governance, freshness
#
# Usage:
#   databricks bundle run -t dev alerting_seed_job
#
# Reference: https://docs.databricks.com/aws/en/sql/user/alerts

resources:
  jobs:
    alerting_seed_job:
      name: "[${bundle.target}] Health Monitor - Alerting Seed Configurations"
      description: "Atomic job: Seeds alert_configurations table with all planned alerts"

      environments:
        - environment_key: default
          spec:
            environment_version: "4"

      tasks:
        - task_key: seed_alerts
          environment_key: default
          notebook_task:
            notebook_path: ../../src/alerting/seed_all_alerts.py
            base_parameters:
              catalog: ${var.catalog}
              gold_schema: ${var.gold_schema}

      timeout_seconds: 1800

      email_notifications:
        on_failure:
          - data-engineering@company.com

      tags:
        environment: ${bundle.target}
        project: health_monitor
        layer: alerting
        job_type: seed
        job_level: atomic
        compute_type: serverless
