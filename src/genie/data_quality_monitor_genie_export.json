{
  "version": 1,
  "config": {
    "sample_questions": [
      {
        "id": "d371587d68871652ae8d4fa97532f50c",
        "question": [
          "Which tables are stale?"
        ]
      },
      {
        "id": "b31439665b7be139a89de37b6b26c1d1",
        "question": [
          "What is our data freshness by domain?"
        ]
      },
      {
        "id": "1f8741583eef22c63e8627695e1dda9d",
        "question": [
          "Show me tables not updated in 24 hours"
        ]
      },
      {
        "id": "2a35d0ce1f006f8f9ade2d0d3ad87051",
        "question": [
          "What tables have freshness issues?"
        ]
      },
      {
        "id": "aeb1c3ce0a59028f97df64557677fc2b",
        "question": [
          "What is our overall data quality score?"
        ]
      },
      {
        "id": "7ec81617fbda0a8335d9d831c8eb7b95",
        "question": [
          "Which tables are failing quality checks?"
        ]
      },
      {
        "id": "4f5005911e04cc22d56a4a11754cc822",
        "question": [
          "Show me data quality summary"
        ]
      },
      {
        "id": "cc4776afe3578980d03a851b35332f4d",
        "question": [
          "What is the quality trend this week?"
        ]
      },
      {
        "id": "ca3bc3a23871696a90ab3a45ebdba6ec",
        "question": [
          "Show me inactive tables"
        ]
      },
      {
        "id": "682fb6369b6913bfa4aff57a3680f3ff",
        "question": [
          "What tables are orphaned?"
        ]
      },
      {
        "id": "8a44d8b760ed72eb029ee81c555dbfc0",
        "question": [
          "Which pipelines have the most dependencies?"
        ]
      },
      {
        "id": "43e6a52ce111f673716bf093b59147bc",
        "question": [
          "Show me table activity status"
        ]
      },
      {
        "id": "eb832ce5950ced1abeb31aa84520e446",
        "question": [
          "Are there any quality anomalies?"
        ]
      },
      {
        "id": "50fe5f0848190eba2a4712e451ce6531",
        "question": [
          "Which tables have degrading quality?"
        ]
      },
      {
        "id": "c90fe2b15f4f982dfacfe58bd16eb40c",
        "question": [
          "Predict data freshness issues"
        ]
      }
    ]
  },
  "data_sources": {
    "tables": [
      {
        "identifier": "${catalog}.${gold_schema}.dim_experiment",
        "description": [
          "Dimension table for MLflow experiments.\n",
          "Business: Tracks ML experiments for data quality models."
        ],
        "column_configs": [
          {
            "column_name": "experiment_id",
            "description": [
              "Unique experiment identifier"
            ]
          },
          {
            "column_name": "experiment_name",
            "description": [
              "Human-readable experiment name"
            ],
            "get_example_values": true,
            "build_value_dictionary": true
          },
          {
            "column_name": "artifact_location",
            "description": [
              "Location of experiment artifacts"
            ]
          }
        ]
      },
      {
        "identifier": "${catalog}.${gold_schema}.dim_served_entities",
        "description": [
          "Dimension table for model serving endpoints.\n",
          "Business: Model serving endpoint metadata."
        ],
        "column_configs": [
          {
            "column_name": "entity_id",
            "description": [
              "Unique entity identifier"
            ]
          },
          {
            "column_name": "entity_name",
            "description": [
              "Entity name"
            ],
            "get_example_values": true,
            "build_value_dictionary": true
          },
          {
            "column_name": "endpoint_name",
            "description": [
              "Serving endpoint name"
            ]
          }
        ]
      },
      {
        "identifier": "${catalog}.${gold_schema}.dim_workspace",
        "description": [
          "Dimension table for workspace details.\n",
          "Business: Links data quality metrics to specific Databricks workspaces."
        ],
        "column_configs": [
          {
            "column_name": "workspace_id",
            "description": [
              "Unique workspace identifier"
            ]
          },
          {
            "column_name": "workspace_name",
            "description": [
              "Human-readable workspace name"
            ],
            "synonyms": [
              "workspace",
              "environment"
            ],
            "get_example_values": true,
            "build_value_dictionary": true
          },
          {
            "column_name": "region",
            "description": [
              "Cloud region"
            ]
          },
          {
            "column_name": "cloud_provider",
            "description": [
              "Cloud provider (AWS, Azure, GCP)"
            ]
          }
        ]
      },
      {
        "identifier": "${catalog}.${gold_schema}.fact_table_lineage",
        "description": [
          "Fact table for table lineage events.\n",
          "Business: Table-level lineage tracking."
        ]
      },
      {
        "identifier": "${catalog}.${gold_schema}.fact_column_lineage",
        "description": [
          "Fact table for column-level lineage.\n",
          "Business: Column-level lineage tracking."
        ]
      },
      {
        "identifier": "${catalog}.${gold_schema}.fact_data_classification",
        "description": [
          "Fact table for data classification tags.\n",
          "Business: Data classification and sensitivity tagging."
        ]
      },
      {
        "identifier": "${catalog}.${gold_schema}.fact_data_classification_results",
        "description": [
          "Fact table for classification scan results.\n",
          "Business: Classification scan execution results."
        ]
      },
      {
        "identifier": "${catalog}.${gold_schema}.fact_dq_monitoring",
        "description": [
          "Fact table for DQ monitoring results.\n",
          "Business: Data quality check execution results."
        ]
      },
      {
        "identifier": "${catalog}.${gold_schema}.fact_data_quality_monitoring_table_results",
        "description": [
          "Fact table for table-level DQ results.\n",
          "Business: Aggregated table-level data quality results."
        ]
      },
      {
        "identifier": "${catalog}.${gold_schema}.fact_predictive_optimization",
        "description": [
          "Fact table for predictive optimization events.\n",
          "Business: Predictive optimization execution tracking."
        ]
      },
      {
        "identifier": "${catalog}.${gold_schema}.fact_mlflow_runs",
        "description": [
          "Fact table for MLflow run history.\n",
          "Business: ML experiment run tracking."
        ]
      },
      {
        "identifier": "${catalog}.${gold_schema}.fact_mlflow_run_metrics_history",
        "description": [
          "Fact table for MLflow metrics over time.\n",
          "Business: ML model training metrics history."
        ]
      },
      {
        "identifier": "${catalog}.${gold_schema}.fact_endpoint_usage",
        "description": [
          "Fact table for model serving usage.\n",
          "Business: Model serving endpoint usage tracking."
        ]
      },
      {
        "identifier": "${catalog}.${gold_schema}.fact_payload_logs",
        "description": [
          "Fact table for model serving payloads.\n",
          "Business: Model inference payload logging."
        ]
      },
      {
        "identifier": "${catalog}.${gold_schema}.fact_listing_access",
        "description": [
          "Fact table for marketplace listing access.\n",
          "Business: Marketplace listing access tracking."
        ]
      },
      {
        "identifier": "${catalog}.${gold_schema}.fact_listing_funnel",
        "description": [
          "Fact table for marketplace funnel events.\n",
          "Business: Marketplace conversion funnel tracking."
        ]
      }
    ],
    "metric_views": [
      {
        "identifier": "${catalog}.${gold_schema}.mv_ml_intelligence",
        "description": [
          "ML model inference intelligence.\n",
          "PURPOSE: Track ML model performance and drift detection.\n",
          "BEST FOR: ML accuracy | Drift score | Prediction count\n",
          "KEY MEASURES: prediction_count, accuracy, drift_score"
        ],
        "column_configs": [
          {
            "column_name": "prediction_count",
            "synonyms": [
              "predictions",
              "inference count"
            ]
          },
          {
            "column_name": "accuracy",
            "synonyms": [
              "model accuracy",
              "ml accuracy"
            ]
          },
          {
            "column_name": "drift_score",
            "synonyms": [
              "model drift",
              "ml drift"
            ]
          }
        ]
      }
    ]
  },
  "instructions": {
    "text_instructions": [
      {
        "id": "489de56d571e635e9f4cae6449f06e45",
        "content": [
          "ROLE: You are a data quality and governance analyst.\n",
          "\n",
          "ASSET SELECTION RULES:\n",
          "1. Current state aggregates (overall quality score, freshness rate) → Use data_quality METRIC VIEW\n",
          "2. Trend/drift queries (is quality degrading?) → Use _drift_metrics TABLE\n",
          "3. List queries (stale tables, failing tables) → Use TVF functions\n",
          "4. Predictions (quality anomalies, freshness alerts) → Use ML prediction tables\n",
          "\n",
          "PRIORITY ORDER:\n",
          "- If user asks for a LIST → TVF (get_table_freshness, get_table_activity_status)\n",
          "- If user asks about TREND → Custom Metrics (_drift_metrics)\n",
          "- If user asks for CURRENT VALUE → Metric View (data_quality)\n",
          "- If user asks for PREDICTION → ML tables\n",
          "\n",
          "⚠️ CUSTOM METRICS QUERY RULES:\n",
          "- _profile_metrics: ALWAYS include column_name=':table' AND log_type='INPUT'\n",
          "- _drift_metrics: ALWAYS include drift_type='CONSECUTIVE' AND column_name=':table'\n",
          "\n",
          "FORMATTING:\n",
          "- Quality scores as 0-100 scale\n",
          "- Percentages with 1 decimal (85.3%)\n",
          "- Sort by quality_score ASC for problem tables\n",
          "- Default to last 7 days if no date specified\n",
          "\n",
          "FRESHNESS RULES:\n",
          "- Fresh: <24 hours\n",
          "- Stale: >24 hours\n",
          "- Critical: >72 hours\n",
          "\n",
          "ACTIVITY RULES:\n",
          "- Active: accessed in last 14 days\n",
          "- Inactive: no access in 14+ days\n",
          "- Orphaned: no access in 30+ days\n",
          "\n",
          "SYNONYMS:\n",
          "- quality = health = status\n",
          "- stale = outdated = old\n",
          "- fresh = current = updated\n"
        ]
      }
    ],
    "example_question_sqls": [
      {
        "id": "d585c41d3761c940d0eb8ffd8e0b82c6",
        "question": [
          "What is our overall data quality score?"
        ],
        "sql": [
          "SELECT MEASURE(freshness_rate) as overall_quality",
          "",
          "FROM ${catalog}.${gold_schema}.mv_data_quality",
          "",
          ""
        ],
        "usage_guidance": [
          "Use for current state overall quality queries"
        ]
      },
      {
        "id": "89da2e0133054923afcea29e7d7ac6a8",
        "question": [
          "Show me tables with freshness issues"
        ],
        "sql": [
          "SELECT * FROM TABLE(get_table_freshness(7, 24))",
          "WHERE hours_since_update > 24",
          "ORDER BY hours_since_update DESC",
          "LIMIT 20;"
        ],
        "usage_guidance": [
          "Use for listing stale tables"
        ]
      }
    ],
    "sql_functions": [
      {
        "id": "be497ff9f29af589476e57aff1fc679b",
        "identifier": "${catalog}.${gold_schema}.get_table_freshness"
      },
      {
        "id": "463ca3718cb1f20b6df91f9d1a13bac8",
        "identifier": "${catalog}.${gold_schema}.get_table_lineage"
      },
      {
        "id": "f3efc560036e0ccd09ff8ad36327b8cb",
        "identifier": "${catalog}.${gold_schema}.get_table_activity_status"
      },
      {
        "id": "8741e2591b4ae88e32e235ee26d4bd4e",
        "identifier": "${catalog}.${gold_schema}.get_data_lineage_summary"
      },
      {
        "id": "c602fbfbb8a51cdfbec26643cd8265bc",
        "identifier": "${catalog}.${gold_schema}.get_pipeline_lineage_impact"
      }
    ],
    "join_specs": [
      {
        "id": "def49189ebf21fc5120a33bf8d9a272b",
        "left": {
          "identifier": "${catalog}.${gold_schema}.fact_table_lineage",
          "alias": "fact_table_lineage"
        },
        "right": {
          "identifier": "${catalog}.${gold_schema}.dim_workspace",
          "alias": "dim_workspace"
        },
        "sql": [
          "`fact_table_lineage`.`workspace_id` = `dim_workspace`.`workspace_id`\n",
          "--rt=FROM_RELATIONSHIP_TYPE_MANY_TO_ONE--"
        ],
        "comment": [
          "Join lineage to workspace for workspace context"
        ]
      },
      {
        "id": "a66171aeadcedeb605b807fdc5a29c84",
        "left": {
          "identifier": "${catalog}.${gold_schema}.fact_mlflow_runs",
          "alias": "fact_mlflow_runs"
        },
        "right": {
          "identifier": "${catalog}.${gold_schema}.dim_experiment",
          "alias": "dim_experiment"
        },
        "sql": [
          "`fact_mlflow_runs`.`workspace_id` = `dim_experiment`.`workspace_id` AND `fact_mlflow_runs`.`experiment_id` = `dim_experiment`.`experiment_id`\n",
          "--rt=FROM_RELATIONSHIP_TYPE_MANY_TO_ONE--"
        ],
        "comment": [
          "Join MLflow runs to experiments"
        ]
      }
    ]
  },
  "benchmarks": {
    "questions": [
      {
        "id": "37dd19999a2e13c114e190803a5e187c",
        "question": [
          "What is our overall data quality score?"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT MEASURE(freshness_rate) as overall_quality",
              "FROM mv_data_quality;"
            ]
          }
        ]
      },
      {
        "id": "a3e09ee970c2846e26575170915af2ea",
        "question": [
          "Show me tables with freshness issues"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT * FROM get_table_freshness(24) WHERE is_stale = TRUE ORDER BY hours_since_update DESC LIMIT 20;"
            ]
          }
        ]
      },
      {
        "id": "d0e2ded00f58b1b8f10e0cfbcf0326f4",
        "question": [
          "What is the completeness rate?"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT MEASURE(total_tables) as completeness_pct",
              "FROM mv_data_quality;"
            ]
          }
        ]
      },
      {
        "id": "9836b3eb035074cbe4e214c1aa81aed9",
        "question": [
          "Show me tables failing quality checks"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT * FROM get_table_activity_status(7, 14) WHERE activity_status = 'INACTIVE'ORDER BY days_since_last_access DESC LIMIT 20;"
            ]
          }
        ]
      },
      {
        "id": "96378659fbc84ca27d9fa282e5842029",
        "question": [
          "What is our data freshness by domain?"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT domain, table_count as total_tables, freshness_threshold, avg_hours_since_update, max_hours_since_update FROM get_data_freshness_by_domain(24) ORDER BY max_hours_since_update DESC LIMIT 15;"
            ]
          }
        ]
      },
      {
        "id": "21fbba3439a78dfb2498050a16bae95a",
        "question": [
          "Show me the data quality summary"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT * FROM get_table_activity_status(7, 14) ORDER BY days_since_last_access DESC LIMIT 20;"
            ]
          }
        ]
      },
      {
        "id": "01ffdb45d3e5e9f898cd1e571e645b4f",
        "question": [
          "What is the validity rate?"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT MEASURE(staleness_rate) as validity_pct",
              "FROM mv_data_quality;"
            ]
          }
        ]
      },
      {
        "id": "2d00597697ea962c161f9668c4b19a7a",
        "question": [
          "Show me inactive tables"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT * FROM get_table_activity_status(30, 14) WHERE activity_status IN ('INACTIVE', 'OR PHANED') ORDER BY days_since_last_access DESC LIMIT 20;"
            ]
          }
        ]
      },
      {
        "id": "f90c7690d7d10b552ee68131de39ff77",
        "question": [
          "What is the freshness rate?"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT MEASURE(freshness_rate) as fresh_pct",
              "FROM mv_data_quality;"
            ]
          }
        ]
      },
      {
        "id": "1be3990d47aafb665e0749d604c64257",
        "question": [
          "Show me pipeline data lineage"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT * FROM get_pipeline_data_lineage(7, '%') ORDER BY complexity_score DESC LIMIT 50;"
            ]
          }
        ]
      },
      {
        "id": "e4a5d34f88921b1e732d7564023dbcf3",
        "question": [
          "What is the job quality status?"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT * FROM get_table_activity_status(7, 14) ORDER BY days_since_last_access DESC LIMIT 15;"
            ]
          }
        ]
      },
      {
        "id": "c12e082cec1f0627820659ee2f639631",
        "question": [
          "What is the staleness rate?"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT MEASURE(staleness_rate) as stale_pct",
              "FROM mv_data_quality;"
            ]
          }
        ]
      },
      {
        "id": "881d6e7d8cc130bc77f1fc7f46d44316",
        "question": [
          "Show me quality score by domain"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT   domain,  MEASURE(freshness_rate) as avg_quality,  MEASURE(total_tables) as table_count FROM mv_data_quality GROUP BY domain ORDER BY avg_quality ASC LIMIT 10;"
            ]
          }
        ]
      },
      {
        "id": "0f0f2d6dfdab3a1f1632ec3bc44f9221",
        "question": [
          "What is our ML model performance?"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT ",
              "  MEASURE(accuracy) as ml_accuracy,",
              "  MEASURE(drift_score) as ml_drift,",
              "  MEASURE(prediction_count) as total_predictions",
              "FROM mv_ml_intelligence;"
            ]
          }
        ]
      },
      {
        "id": "d5bc0884e82891cdb83738d699960bfe",
        "question": [
          "What is our ML prediction accuracy?"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT ",
              "  MEASURE(accuracy) as model_accuracy,",
              "  MEASURE(prediction_count) as predictions",
              "FROM mv_ml_intelligence;"
            ]
          }
        ]
      },
      {
        "id": "d206e41a02d897ac3a9bb51232e6aa76",
        "question": [
          "Show me quality score distribution"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT   CASE     WHEN MEASURE(freshness_rate) >= 90 THEN 'Excellent (90-100)'    WHEN MEASURE(freshness_rate) >= 70 THEN 'Good (70-89)'    WHEN MEASURE(freshness_rate) >= 50 THEN 'Fair (50-69)'    ELSE 'Poor (<50)'  END as quality_tier,  COUNT(*) as table_count FROM mv_data_quality GROUP BY quality_tier ORDER BY MIN(MEASURE(freshness_rate)) DESC;"
            ]
          }
        ]
      }
    ]
  }
}