{
  "version": 1,
  "config": {
    "sample_questions": [
      {
        "id": "a1b2c3d4e5f6789012345678901234ab",
        "question": "Who accessed this table?"
      },
      {
        "id": "b2c3d4e5f6789012345678901234abc1",
        "question": "Show me user activity for john@company.com"
      },
      {
        "id": "c3d4e5f6789012345678901234abc12d",
        "question": "Which tables are most frequently accessed?"
      },
      {
        "id": "d4e5f6789012345678901234abc12de3",
        "question": "Who accessed sensitive data this week?"
      },
      {
        "id": "e5f6789012345678901234abc12de34f",
        "question": "Show me failed access attempts"
      },
      {
        "id": "f6789012345678901234abc12de34f56",
        "question": "What permission changes happened today?"
      },
      {
        "id": "789012345678901234abc12de34f5678",
        "question": "Show me off-hours activity"
      },
      {
        "id": "89012345678901234abc12de34f56789",
        "question": "Which service accounts are most active?"
      },
      {
        "id": "9012345678901234abc12de34f56789a",
        "question": "Show me unusual access patterns"
      },
      {
        "id": "012345678901234abc12de34f56789ab",
        "question": "What sensitive actions occurred?"
      },
      {
        "id": "12345678901234abc12de34f56789abc",
        "question": "Show me security events timeline"
      },
      {
        "id": "2345678901234abc12de34f56789abcd",
        "question": "Which users have the most failed actions?"
      },
      {
        "id": "345678901234abc12de34f56789abcde",
        "question": "Are there any security anomalies?"
      },
      {
        "id": "45678901234abc12de34f56789abcdef",
        "question": "What's the risk score for this user?"
      },
      {
        "id": "5678901234abc12de34f56789abcdef0",
        "question": "Show me suspicious activity patterns"
      }
    ]
  },
  "data_sources": {
    "tables": [],
    "metric_views": [
      {
        "identifier": "${catalog}.${gold_schema}.mv_security_events"
      }
    ]
  },
  "instructions": {
    "text_instructions": [
      {
        "id": "6789abcdef0123456789abcdef012345",
        "content": [
          "You are a Databricks security and compliance analyst. Follow these rules:",
          "",
          "1. **Asset Selection:** Use Metric View for current state, TVFs for lists, Custom Metrics for trends",
          "2. **Primary Source:** Use mv_security_events metric view for dashboard KPIs",
          "3. **TVFs for Lists:** Use TVFs for user-specific or \"who accessed\" queries, always wrap with TABLE()",
          "4. **Trends:** For \"is failure rate increasing?\" check _drift_metrics tables",
          "5. **Date Default:** If no date specified, default to last 7 days",
          "6. **User Types:** HUMAN_USER, SERVICE_PRINCIPAL, SYSTEM",
          "7. **Risk Levels:** LOW (0-25), MEDIUM (26-50), HIGH (51-75), CRITICAL (76-100)",
          "8. **Sorting:** Sort by risk_score DESC for security queries",
          "9. **Limits:** Top 20 for activity lists",
          "10. **Synonyms:** user=identity=principal, access=event=action",
          "11. **Custom Metrics:** Always include required filters (column_name=':table', log_type='INPUT')",
          "12. **Context:** Explain READ vs WRITE vs DDL actions",
          "13. **Compliance:** Never expose PII in responses",
          "14. **Performance:** Never scan Bronze/Silver tables",
          "15. **TVF Calls:** Always use TABLE() wrapper for TVF calls"
        ]
      }
    ],
    "sql_functions": [
      {
        "identifier": "${catalog}.${gold_schema}.get_user_activity_summary"
      },
      {
        "identifier": "${catalog}.${gold_schema}.get_table_access_events"
      },
      {
        "identifier": "${catalog}.${gold_schema}.get_permission_changes"
      },
      {
        "identifier": "${catalog}.${gold_schema}.get_service_principal_activity"
      },
      {
        "identifier": "${catalog}.${gold_schema}.get_failed_actions"
      },
      {
        "identifier": "${catalog}.${gold_schema}.get_sensitive_table_access"
      },
      {
        "identifier": "${catalog}.${gold_schema}.get_off_hours_activity"
      },
      {
        "identifier": "${catalog}.${gold_schema}.get_anomalous_access_events"
      },
      {
        "identifier": "${catalog}.${gold_schema}.get_data_exfiltration_events"
      }
    ]
  },
  "benchmarks": {
    "questions": [
      {
        "id": "789abcdef0123456789abcdef0123456",
        "question": [
          "What is our total event count this week?"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT MEASURE(total_events) as event_count FROM mv_security_events WHERE event_date >= CURRENT_DATE() - INTERVAL 7 DAYS;"
            ]
          }
        ]
      },
      {
        "id": "89abcdef0123456789abcdef01234567",
        "question": [
          "What is the failure rate for security events?"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT  MEASURE(failed_events) / NULLIF(MEASURE(total_events), 0) * 100 as failure_rate_pct FROM mv_security_events WHERE event_date >= CURRENT_DATE() - INTERVAL 7 DAYS;"
            ]
          }
        ]
      },
      {
        "id": "9abcdef0123456789abcdef012345678",
        "question": [
          "Show me events by user"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT  user_email,  MEASURE(total_events) as event_count,  MEASURE(failed_events) as failed_count FROM mv_security_events WHERE event_date >= CURRENT_DATE() - INTERVAL 7 DAYS GROUP BY user_email ORDER BY event_count DESC LIMIT 15;"
            ]
          }
        ]
      },
      {
        "id": "abcdef0123456789abcdef0123456789",
        "question": [
          "What is the success rate?"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT (1.0 - MEASURE(failed_events) / NULLIF(MEASURE(total_events), 0)) * 100 as success_pct FROM mv_security_events WHERE event_date >= CURRENT_DATE() - INTERVAL 7 DAYS;"
            ]
          }
        ]
      },
      {
        "id": "bcdef0123456789abcdef0123456789a",
        "question": [
          "Show me user activity summary"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT * FROM get_user_activity_summary(\n  CAST(CURRENT_DATE(), CURRENT_DATE()::STRING,\n  10\n) - INTERVAL 7 DAYS AS STRING),  CAST(CURRENT_DATE() AS STRING),  20) ORDER BY total_events DESC;"
            ]
          }
        ]
      },
      {
        "id": "cdef0123456789abcdef0123456789ab",
        "question": [
          "Who accessed sensitive tables?"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT * FROM get_sensitive_table_access(\n  CAST(CURRENT_DATE(), CURRENT_DATE()::STRING,\n  '%'\n) - INTERVAL 7 DAYS AS STRING),  CAST(CURRENT_DATE() AS STRING)) ORDER BY access_count DESC LIMIT 20;"
            ]
          }
        ]
      },
      {
        "id": "def0123456789abcdef0123456789abc",
        "question": [
          "Show me failed access attempts"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT * FROM get_failed_actions(\n  7,\n  CURRENT_DATE()::STRING,\n  '%'\n) ORDER BY event_time DESC LIMIT 20;"
            ]
          }
        ]
      },
      {
        "id": "ef0123456789abcdef0123456789abcd",
        "question": [
          "What permission changes happened this week?"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT * FROM get_permission_changes(\n  7,\n  CURRENT_DATE()::STRING\n) ORDER BY event_time DESC LIMIT 20;"
            ]
          }
        ]
      },
      {
        "id": "f0123456789abcdef0123456789abcde",
        "question": [
          "Show me unusual access patterns"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT * FROM get_off_hours_activity(\n  CAST(CURRENT_DATE() - INTERVAL 7 DAYS AS STRING),\n  CAST(CURRENT_DATE() AS STRING),\n  7,\n  19\n) ORDER BY off_hours_events DESC LIMIT 20;"
            ]
          }
        ]
      },
      {
        "id": "0123456789abcdef0123456789abcdef",
        "question": [
          "What are the high-risk events?"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT  user_email,  action_category,  MEASURE(failed_events) as risk_events FROM mv_security_events WHERE event_date >= CURRENT_DATE() - INTERVAL 7 DAYS  AND audit_level = 'HIGH'GROUP BY user_email, action_category ORDER BY risk_events DESC LIMIT 15;"
            ]
          }
        ]
      },
      {
        "id": "123456789abcdef0123456789abcdef0",
        "question": [
          "Show me user activity patterns"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT * FROM get_off_hours_activity(\n  CAST(CURRENT_DATE() - INTERVAL 30 DAYS AS STRING),\n  CAST(CURRENT_DATE() AS STRING),\n  7,\n  19\n) ORDER BY user_email, event_date LIMIT 50;"
            ]
          }
        ]
      },
      {
        "id": "23456789abcdef0123456789abcdef01",
        "question": [
          "What is the unique user count?"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT MEASURE(unique_users) as user_count FROM mv_security_events WHERE event_date >= CURRENT_DATE() - INTERVAL 7 DAYS;"
            ]
          }
        ]
      },
      {
        "id": "3456789abcdef0123456789abcdef012",
        "question": [
          "Show me data export events"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT * FROM get_table_access_audit(  CAST(CURRENT_DATE() - INTERVAL 7 DAYS AS STRING),  CAST(CURRENT_DATE() AS STRING),  '%') ORDER BY access_count DESC LIMIT 20;"
            ]
          }
        ]
      },
      {
        "id": "456789abcdef0123456789abcdef0123",
        "question": [
          "Show me governance data lineage"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT  MEASURE(read_events) as read_count,  MEASURE(write_events) as write_count,  MEASURE(active_table_count) as active_tables FROM mv_governance_analytics WHERE event_date >= CURRENT_DATE() - INTERVAL 7 DAYS;"
            ]
          }
        ]
      },
      {
        "id": "56789abcdef0123456789abcdef01234",
        "question": [
          "What is the unique data consumer count?"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT MEASURE(unique_users) as consumer_count FROM mv_governance_analytics WHERE event_date >= CURRENT_DATE() - INTERVAL 7 DAYS;"
            ]
          }
        ]
      },
      {
        "id": "6789abcdef0123456789abcdef012345",
        "question": [
          "Show me service account activity"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT * FROM get_service_account_audit(30) ORDER BY total_events DESC LIMIT 20;"
            ]
          }
        ]
      },
      {
        "id": "b16acdef0123456789abcdef01234516",
        "question": [
          "Show me security event drift"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT  window.start AS period_start,  event_volume_drift_pct,  sensitive_action_drift,  failure_rate_drift FROM prashanth_subrahmanyam_catalog.dev_prashanth_subrahmanyam_system_gold_monitoring.fact_audit_logs_drift_metrics WHERE drift_type = 'CONSECUTIVE'  AND column_name = ':table'  AND window.start >= CURRENT_DATE() - INTERVAL 7 DAYS ORDER BY window.start DESC LIMIT 10;"
            ]
          }
        ]
      },
      {
        "id": "c17adef01234567890abcdef1234517a",
        "question": [
          "Show me table access audit"
        ],
        "answer": [
          {
            "format": "SQL",
            "content": [
              "SELECT * FROM get_table_access_audit(  CAST(CURRENT_DATE() - INTERVAL 7 DAYS AS STRING),  CAST(CURRENT_DATE() AS STRING),  '%') ORDER BY access_count DESC LIMIT 20;"
            ]
          }
        ]
      }
    ]
  }
}