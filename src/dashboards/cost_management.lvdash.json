{
  "displayName": "Cost Management Dashboard",
  "warehouse_id": "${warehouse_id}",
  "pages": [
    {
      "name": "page_cost_overview",
      "displayName": "\ud83d\udcb0 Cost Overview",
      "layout": [
        {
          "widget": {
            "name": "kpi_mtd_spend",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_kpi_mtd",
                  "fields": [
                    {
                      "name": "mtd_cost",
                      "expression": "`mtd_cost`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "mtd_cost"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "MTD Spend",
                "description": "Month-to-Date Total"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 0,
            "width": 2,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "kpi_30d_spend",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_kpi_30d",
                  "fields": [
                    {
                      "name": "total_cost",
                      "expression": "`total_cost`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "total_cost"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "30-Day Spend"
              }
            }
          },
          "position": {
            "x": 2,
            "y": 0,
            "width": 2,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "kpi_30d_growth",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_30_60_compare",
                  "fields": [
                    {
                      "name": "growth_pct",
                      "expression": "`growth_pct`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "growth_pct"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "30d vs 60d Growth %"
              }
            }
          },
          "position": {
            "x": 4,
            "y": 0,
            "width": 2,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "kpi_tag_coverage",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_tag_coverage",
                  "fields": [
                    {
                      "name": "coverage_pct",
                      "expression": "`coverage_pct`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "coverage_pct"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Tag Coverage %"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 2,
            "width": 2,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "kpi_serverless",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_serverless_adoption",
                  "fields": [
                    {
                      "name": "serverless_pct",
                      "expression": "`serverless_pct`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "serverless_pct"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Serverless Adoption %"
              }
            }
          },
          "position": {
            "x": 2,
            "y": 2,
            "width": 2,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "kpi_unique_users",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_unique_counts",
                  "fields": [
                    {
                      "name": "unique_users",
                      "expression": "`unique_users`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "unique_users"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Active Users (30d)"
              }
            }
          },
          "position": {
            "x": 4,
            "y": 2,
            "width": 2,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "chart_wow_growth",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_wow_growth",
                  "fields": [
                    {
                      "name": "week_start",
                      "expression": "`week_start`"
                    },
                    {
                      "name": "weekly_cost",
                      "expression": "`weekly_cost`"
                    },
                    {
                      "name": "wow_growth_pct",
                      "expression": "`wow_growth_pct`"
                    },
                    {
                      "name": "moving_avg",
                      "expression": "`moving_avg`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "line",
              "encodings": {
                "x": {
                  "fieldName": "week_start",
                  "displayName": "Week",
                  "scale": {
                    "type": "temporal"
                  }
                },
                "y": {
                  "fields": [
                    {
                      "fieldName": "weekly_cost",
                      "displayName": "Weekly Cost ($)"
                    }
                  ],
                  "scale": {
                    "type": "quantitative"
                  }
                }
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83d\udcc8 Week-over-Week Cost & Growth Trend"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 4,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "chart_daily_cost",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_daily_cost",
                  "fields": [
                    {
                      "name": "usage_date",
                      "expression": "`usage_date`"
                    },
                    {
                      "name": "daily_cost",
                      "expression": "`daily_cost`"
                    },
                    {
                      "name": "serverless_cost",
                      "expression": "`serverless_cost`"
                    },
                    {
                      "name": "classic_cost",
                      "expression": "`classic_cost`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "area",
              "encodings": {
                "x": {
                  "fieldName": "usage_date",
                  "displayName": "Date",
                  "scale": {
                    "type": "temporal"
                  }
                },
                "y": {
                  "fields": [
                    {
                      "fieldName": "serverless_cost",
                      "displayName": "Serverless ($)"
                    },
                    {
                      "fieldName": "classic_cost",
                      "displayName": "Classic ($)"
                    }
                  ],
                  "scale": {
                    "type": "quantitative"
                  }
                }
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83d\udcca Daily Cost: Serverless vs Classic"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 10,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "table_top_workspaces",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_top_workspaces",
                  "disaggregated": true,
                  "fields": [
                    {
                      "name": "workspace_name",
                      "expression": "`workspace_name`"
                    },
                    {
                      "name": "total_cost",
                      "expression": "`total_cost`"
                    },
                    {
                      "name": "unique_users",
                      "expression": "`unique_users`"
                    },
                    {
                      "name": "job_count",
                      "expression": "`job_count`"
                    },
                    {
                      "name": "job_runs",
                      "expression": "`job_runs`"
                    }
                  ]
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "workspace_name",
                    "title": "Workspace",
                    "type": "string"
                  },
                  {
                    "fieldName": "total_cost",
                    "title": "Cost ($)",
                    "type": "number"
                  },
                  {
                    "fieldName": "unique_users",
                    "title": "Users",
                    "type": "number"
                  },
                  {
                    "fieldName": "job_count",
                    "title": "Jobs",
                    "type": "number"
                  },
                  {
                    "fieldName": "job_runs",
                    "title": "Runs",
                    "type": "number"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83c\udfe2 Top Workspaces (30d)"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 16,
            "width": 3,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "chart_sku_breakdown",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_sku_breakdown",
                  "fields": [
                    {
                      "name": "sku_name",
                      "expression": "`sku_name`"
                    },
                    {
                      "name": "total_cost",
                      "expression": "`total_cost`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "pie",
              "encodings": {
                "theta": {
                  "fieldName": "total_cost",
                  "displayName": "Cost ($)"
                },
                "color": {
                  "fieldName": "sku_name",
                  "displayName": "SKU"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83d\udce6 Spend by SKU"
              }
            }
          },
          "position": {
            "x": 3,
            "y": 16,
            "width": 3,
            "height": 6
          }
        }
      ]
    },
    {
      "name": "page_cost_attribution",
      "displayName": "\ud83c\udff7\ufe0f Cost Attribution",
      "layout": [
        {
          "widget": {
            "name": "table_top_owners",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_top_owners",
                  "disaggregated": true,
                  "fields": [
                    {
                      "name": "owner",
                      "expression": "`owner`"
                    },
                    {
                      "name": "total_cost",
                      "expression": "`total_cost`"
                    },
                    {
                      "name": "job_cost",
                      "expression": "`job_cost`"
                    },
                    {
                      "name": "notebook_cost",
                      "expression": "`notebook_cost`"
                    }
                  ]
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "owner",
                    "title": "Owner",
                    "type": "string"
                  },
                  {
                    "fieldName": "total_cost",
                    "title": "Cost ($)",
                    "type": "number"
                  },
                  {
                    "fieldName": "job_cost",
                    "title": "Jobs ($)",
                    "type": "number"
                  },
                  {
                    "fieldName": "notebook_cost",
                    "title": "Notebooks ($)",
                    "type": "number"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83d\udcb5 Cost by Owner (30d)"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 0,
            "width": 3,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "table_spend_by_tag",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_spend_by_tag",
                  "disaggregated": true,
                  "fields": [
                    {
                      "name": "tag_bucket",
                      "expression": "`tag_bucket`"
                    },
                    {
                      "name": "total_cost",
                      "expression": "`total_cost`"
                    }
                  ]
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "tag_bucket",
                    "title": "Tag",
                    "type": "string"
                  },
                  {
                    "fieldName": "total_cost",
                    "title": "Cost ($)",
                    "type": "number"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83c\udff7\ufe0f Spend by Tag"
              }
            }
          },
          "position": {
            "x": 3,
            "y": 0,
            "width": 3,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "table_highest_change_users",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_highest_change_users",
                  "disaggregated": true,
                  "fields": [
                    {
                      "name": "owner",
                      "expression": "`owner`"
                    },
                    {
                      "name": "last_7d",
                      "expression": "`last_7d`"
                    },
                    {
                      "name": "prev_7d",
                      "expression": "`prev_7d`"
                    },
                    {
                      "name": "growth",
                      "expression": "`growth`"
                    },
                    {
                      "name": "growth_pct",
                      "expression": "`growth_pct`"
                    }
                  ]
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "owner",
                    "title": "User",
                    "type": "string"
                  },
                  {
                    "fieldName": "last_7d",
                    "title": "Last 7d ($)",
                    "type": "number"
                  },
                  {
                    "fieldName": "prev_7d",
                    "title": "Prev 7d ($)",
                    "type": "number"
                  },
                  {
                    "fieldName": "growth",
                    "title": "Growth ($)",
                    "type": "number"
                  },
                  {
                    "fieldName": "growth_pct",
                    "title": "Growth %",
                    "type": "number"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83d\udcc8 Users with Highest Cost Increase"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 6,
            "width": 3,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "table_untagged_cost",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_untagged_cost",
                  "disaggregated": true,
                  "fields": [
                    {
                      "name": "workspace_name",
                      "expression": "`workspace_name`"
                    },
                    {
                      "name": "owner",
                      "expression": "`owner`"
                    },
                    {
                      "name": "untagged_cost",
                      "expression": "`untagged_cost`"
                    }
                  ]
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "workspace_name",
                    "title": "Workspace",
                    "type": "string"
                  },
                  {
                    "fieldName": "owner",
                    "title": "Owner",
                    "type": "string"
                  },
                  {
                    "fieldName": "untagged_cost",
                    "title": "Untagged Cost ($)",
                    "type": "number"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "\u26a0\ufe0f Untagged Resources by Owner"
              }
            }
          },
          "position": {
            "x": 3,
            "y": 6,
            "width": 3,
            "height": 6
          }
        }
      ]
    },
    {
      "name": "page_jobs_cost",
      "displayName": "\u2699\ufe0f Jobs Cost Analysis",
      "layout": [
        {
          "widget": {
            "name": "table_expensive_jobs",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_expensive_jobs",
                  "disaggregated": true,
                  "fields": [
                    {
                      "name": "job_name",
                      "expression": "`job_name`"
                    },
                    {
                      "name": "workspace_name",
                      "expression": "`workspace_name`"
                    },
                    {
                      "name": "runs",
                      "expression": "`runs`"
                    },
                    {
                      "name": "total_cost",
                      "expression": "`total_cost`"
                    },
                    {
                      "name": "owner",
                      "expression": "`owner`"
                    }
                  ]
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "job_name",
                    "title": "Job",
                    "type": "string"
                  },
                  {
                    "fieldName": "workspace_name",
                    "title": "Workspace",
                    "type": "string"
                  },
                  {
                    "fieldName": "runs",
                    "title": "Runs",
                    "type": "number"
                  },
                  {
                    "fieldName": "total_cost",
                    "title": "Cost ($)",
                    "type": "number"
                  },
                  {
                    "fieldName": "owner",
                    "title": "Owner",
                    "type": "string"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83d\udcb0 Most Expensive Jobs (30d)"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 0,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "table_expensive_runs",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_expensive_runs",
                  "disaggregated": true,
                  "fields": [
                    {
                      "name": "job_name",
                      "expression": "`job_name`"
                    },
                    {
                      "name": "run_id",
                      "expression": "`run_id`"
                    },
                    {
                      "name": "run_cost",
                      "expression": "`run_cost`"
                    },
                    {
                      "name": "run_date",
                      "expression": "`run_date`"
                    }
                  ]
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "job_name",
                    "title": "Job",
                    "type": "string"
                  },
                  {
                    "fieldName": "run_id",
                    "title": "Run ID",
                    "type": "string"
                  },
                  {
                    "fieldName": "run_cost",
                    "title": "Run Cost ($)",
                    "type": "number"
                  },
                  {
                    "fieldName": "run_date",
                    "title": "Date",
                    "type": "datetime"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83c\udfc3 Most Expensive Individual Runs (30d)"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 6,
            "width": 3,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "table_highest_change_jobs",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_highest_change_jobs",
                  "disaggregated": true,
                  "fields": [
                    {
                      "name": "job_name",
                      "expression": "`job_name`"
                    },
                    {
                      "name": "last_7d",
                      "expression": "`last_7d`"
                    },
                    {
                      "name": "prev_7d",
                      "expression": "`prev_7d`"
                    },
                    {
                      "name": "growth",
                      "expression": "`growth`"
                    },
                    {
                      "name": "growth_pct",
                      "expression": "`growth_pct`"
                    }
                  ]
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "job_name",
                    "title": "Job",
                    "type": "string"
                  },
                  {
                    "fieldName": "last_7d",
                    "title": "Last 7d ($)",
                    "type": "number"
                  },
                  {
                    "fieldName": "prev_7d",
                    "title": "Prev 7d ($)",
                    "type": "number"
                  },
                  {
                    "fieldName": "growth",
                    "title": "Growth ($)",
                    "type": "number"
                  },
                  {
                    "fieldName": "growth_pct",
                    "title": "Growth %",
                    "type": "number"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83d\udcc8 Jobs with Highest Cost Increase (7d vs 14d)"
              }
            }
          },
          "position": {
            "x": 3,
            "y": 6,
            "width": 3,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "table_outlier_job_runs",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_outlier_runs",
                  "disaggregated": true,
                  "fields": [
                    {
                      "name": "job_name",
                      "expression": "`job_name`"
                    },
                    {
                      "name": "runs",
                      "expression": "`runs`"
                    },
                    {
                      "name": "avg_cost",
                      "expression": "`avg_cost`"
                    },
                    {
                      "name": "max_cost",
                      "expression": "`max_cost`"
                    },
                    {
                      "name": "p90",
                      "expression": "`p90`"
                    },
                    {
                      "name": "deviation",
                      "expression": "`deviation`"
                    }
                  ]
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "job_name",
                    "title": "Job",
                    "type": "string"
                  },
                  {
                    "fieldName": "runs",
                    "title": "Runs",
                    "type": "number"
                  },
                  {
                    "fieldName": "avg_cost",
                    "title": "Avg ($)",
                    "type": "number"
                  },
                  {
                    "fieldName": "max_cost",
                    "title": "Max ($)",
                    "type": "number"
                  },
                  {
                    "fieldName": "p90",
                    "title": "P90 ($)",
                    "type": "number"
                  },
                  {
                    "fieldName": "deviation",
                    "title": "Deviation",
                    "type": "number"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83d\udcca Jobs with Outlier Runs (Max >> P90)"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 12,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "table_failure_cost",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_failure_cost",
                  "disaggregated": true,
                  "fields": [
                    {
                      "name": "job_name",
                      "expression": "`job_name`"
                    },
                    {
                      "name": "failure_cost",
                      "expression": "`failure_cost`"
                    },
                    {
                      "name": "failures",
                      "expression": "`failures`"
                    },
                    {
                      "name": "success_rate",
                      "expression": "`success_rate`"
                    }
                  ]
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "job_name",
                    "title": "Job",
                    "type": "string"
                  },
                  {
                    "fieldName": "failure_cost",
                    "title": "Failure Cost ($)",
                    "type": "number"
                  },
                  {
                    "fieldName": "failures",
                    "title": "Failures",
                    "type": "number"
                  },
                  {
                    "fieldName": "success_rate",
                    "title": "Success %",
                    "type": "number"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83d\udcb8 Cost of Job Failures (30d)"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 18,
            "width": 3,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "table_repair_cost",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_repair_cost",
                  "disaggregated": true,
                  "fields": [
                    {
                      "name": "job_name",
                      "expression": "`job_name`"
                    },
                    {
                      "name": "repairs",
                      "expression": "`repairs`"
                    },
                    {
                      "name": "repair_cost",
                      "expression": "`repair_cost`"
                    },
                    {
                      "name": "repair_time_min",
                      "expression": "`repair_time_min`"
                    }
                  ]
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "job_name",
                    "title": "Job",
                    "type": "string"
                  },
                  {
                    "fieldName": "repairs",
                    "title": "Repairs",
                    "type": "number"
                  },
                  {
                    "fieldName": "repair_cost",
                    "title": "Repair Cost ($)",
                    "type": "number"
                  },
                  {
                    "fieldName": "repair_time_min",
                    "title": "Time (min)",
                    "type": "number"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83d\udd27 Most Repaired Jobs & Cost"
              }
            }
          },
          "position": {
            "x": 3,
            "y": 18,
            "width": 3,
            "height": 6
          }
        }
      ]
    },
    {
      "name": "page_optimization",
      "displayName": "\ud83c\udfaf Optimization Opportunities",
      "layout": [
        {
          "widget": {
            "name": "table_stale_datasets",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_stale_datasets",
                  "disaggregated": true,
                  "fields": [
                    {
                      "name": "job_name",
                      "expression": "`job_name`"
                    },
                    {
                      "name": "unused_tables",
                      "expression": "`unused_tables`"
                    },
                    {
                      "name": "total_cost",
                      "expression": "`total_cost`"
                    },
                    {
                      "name": "last_run",
                      "expression": "`last_run`"
                    }
                  ]
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "job_name",
                    "title": "Job",
                    "type": "string"
                  },
                  {
                    "fieldName": "unused_tables",
                    "title": "Unused Tables",
                    "type": "number"
                  },
                  {
                    "fieldName": "total_cost",
                    "title": "Cost ($)",
                    "type": "number"
                  },
                  {
                    "fieldName": "last_run",
                    "title": "Last Run",
                    "type": "datetime"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83d\udce6 Jobs Producing Unconsumed Data"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 0,
            "width": 3,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "table_ap_clusters",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_ap_cluster_jobs",
                  "disaggregated": true,
                  "fields": [
                    {
                      "name": "job_name",
                      "expression": "`job_name`"
                    },
                    {
                      "name": "cluster_name",
                      "expression": "`cluster_name`"
                    },
                    {
                      "name": "task_runs",
                      "expression": "`task_runs`"
                    },
                    {
                      "name": "total_cost",
                      "expression": "`total_cost`"
                    }
                  ]
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "job_name",
                    "title": "Job",
                    "type": "string"
                  },
                  {
                    "fieldName": "cluster_name",
                    "title": "Cluster",
                    "type": "string"
                  },
                  {
                    "fieldName": "task_runs",
                    "title": "Task Runs",
                    "type": "number"
                  },
                  {
                    "fieldName": "total_cost",
                    "title": "Cost ($)",
                    "type": "number"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83d\udda5\ufe0f Jobs Using All-Purpose Clusters"
              }
            }
          },
          "position": {
            "x": 3,
            "y": 0,
            "width": 3,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "table_no_autoscale",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_no_autoscale",
                  "disaggregated": true,
                  "fields": [
                    {
                      "name": "job_name",
                      "expression": "`job_name`"
                    },
                    {
                      "name": "worker_count",
                      "expression": "`worker_count`"
                    },
                    {
                      "name": "total_cost",
                      "expression": "`total_cost`"
                    },
                    {
                      "name": "owner",
                      "expression": "`owner`"
                    }
                  ]
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "job_name",
                    "title": "Job",
                    "type": "string"
                  },
                  {
                    "fieldName": "worker_count",
                    "title": "Workers",
                    "type": "number"
                  },
                  {
                    "fieldName": "total_cost",
                    "title": "Cost ($)",
                    "type": "number"
                  },
                  {
                    "fieldName": "owner",
                    "title": "Owner",
                    "type": "string"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "\u26a0\ufe0f Jobs Without Autoscaling"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 6,
            "width": 3,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "table_low_dbr",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_low_dbr_jobs",
                  "disaggregated": true,
                  "fields": [
                    {
                      "name": "job_name",
                      "expression": "`job_name`"
                    },
                    {
                      "name": "dbr_version",
                      "expression": "`dbr_version`"
                    },
                    {
                      "name": "total_cost",
                      "expression": "`total_cost`"
                    },
                    {
                      "name": "owner",
                      "expression": "`owner`"
                    }
                  ]
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "job_name",
                    "title": "Job",
                    "type": "string"
                  },
                  {
                    "fieldName": "dbr_version",
                    "title": "DBR",
                    "type": "string"
                  },
                  {
                    "fieldName": "total_cost",
                    "title": "Cost ($)",
                    "type": "number"
                  },
                  {
                    "fieldName": "owner",
                    "title": "Owner",
                    "type": "string"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83d\udd04 Jobs on Legacy DBR Versions"
              }
            }
          },
          "position": {
            "x": 3,
            "y": 6,
            "width": 3,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "table_no_tags",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_no_tags_jobs",
                  "disaggregated": true,
                  "fields": [
                    {
                      "name": "job_name",
                      "expression": "`job_name`"
                    },
                    {
                      "name": "workspace_name",
                      "expression": "`workspace_name`"
                    },
                    {
                      "name": "owner",
                      "expression": "`owner`"
                    }
                  ]
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "job_name",
                    "title": "Job",
                    "type": "string"
                  },
                  {
                    "fieldName": "workspace_name",
                    "title": "Workspace",
                    "type": "string"
                  },
                  {
                    "fieldName": "owner",
                    "title": "Owner",
                    "type": "string"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83c\udff7\ufe0f Jobs Without Tags"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 12,
            "width": 3,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "table_savings_potential",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_savings_potential",
                  "disaggregated": true,
                  "fields": [
                    {
                      "name": "job_name",
                      "expression": "`job_name`"
                    },
                    {
                      "name": "avg_cpu",
                      "expression": "`avg_cpu`"
                    },
                    {
                      "name": "total_cost",
                      "expression": "`total_cost`"
                    },
                    {
                      "name": "max_savings",
                      "expression": "`max_savings`"
                    }
                  ]
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "job_name",
                    "title": "Job",
                    "type": "string"
                  },
                  {
                    "fieldName": "avg_cpu",
                    "title": "Avg CPU %",
                    "type": "number"
                  },
                  {
                    "fieldName": "total_cost",
                    "title": "Cost ($)",
                    "type": "number"
                  },
                  {
                    "fieldName": "max_savings",
                    "title": "Potential Savings ($)",
                    "type": "number"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83d\udcb0 Right-Sizing Savings Opportunities"
              }
            }
          },
          "position": {
            "x": 3,
            "y": 12,
            "width": 3,
            "height": 6
          }
        }
      ]
    },
    {
      "name": "page_ml_predictions",
      "displayName": "\ud83e\udd16 ML Predictions",
      "layout": [
        {
          "widget": {
            "name": "chart_ml_forecast",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_ml_cost_forecast",
                  "fields": [
                    {
                      "name": "forecast_date",
                      "expression": "`forecast_date`"
                    },
                    {
                      "name": "forecasted_cost",
                      "expression": "`forecasted_cost`"
                    },
                    {
                      "name": "lower_bound",
                      "expression": "`lower_bound`"
                    },
                    {
                      "name": "upper_bound",
                      "expression": "`upper_bound`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "line",
              "encodings": {
                "x": {
                  "fieldName": "forecast_date",
                  "displayName": "Date",
                  "scale": {
                    "type": "temporal"
                  }
                },
                "y": {
                  "fields": [
                    {
                      "fieldName": "forecasted_cost",
                      "displayName": "Forecast"
                    },
                    {
                      "fieldName": "lower_bound",
                      "displayName": "Lower"
                    },
                    {
                      "fieldName": "upper_bound",
                      "displayName": "Upper"
                    }
                  ],
                  "scale": {
                    "type": "quantitative"
                  }
                }
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83e\udd16 ML: 30-Day Cost Forecast",
                "description": "Prophet time series model with confidence intervals"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 0,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "table_ml_anomalies",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_ml_anomalies",
                  "disaggregated": true,
                  "fields": [
                    {
                      "name": "usage_date",
                      "expression": "`usage_date`"
                    },
                    {
                      "name": "workspace_name",
                      "expression": "`workspace_name`"
                    },
                    {
                      "name": "sku_name",
                      "expression": "`sku_name`"
                    },
                    {
                      "name": "anomaly_score",
                      "expression": "`anomaly_score`"
                    },
                    {
                      "name": "severity",
                      "expression": "`severity`"
                    }
                  ]
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "usage_date",
                    "title": "Date",
                    "type": "datetime"
                  },
                  {
                    "fieldName": "workspace_name",
                    "title": "Workspace",
                    "type": "string"
                  },
                  {
                    "fieldName": "sku_name",
                    "title": "SKU",
                    "type": "string"
                  },
                  {
                    "fieldName": "anomaly_score",
                    "title": "Score",
                    "type": "number"
                  },
                  {
                    "fieldName": "severity",
                    "title": "Severity",
                    "type": "string"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83e\udd16 ML: Detected Cost Anomalies",
                "description": "Isolation Forest anomaly detection"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 6,
            "width": 3,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "table_ml_budget_alerts",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_ml_budget_alerts",
                  "disaggregated": true,
                  "fields": [
                    {
                      "name": "workspace_name",
                      "expression": "`workspace_name`"
                    },
                    {
                      "name": "alert_priority",
                      "expression": "`alert_priority`"
                    },
                    {
                      "name": "burn_rate",
                      "expression": "`burn_rate`"
                    },
                    {
                      "name": "days_to_budget",
                      "expression": "`days_to_budget`"
                    }
                  ]
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "workspace_name",
                    "title": "Workspace",
                    "type": "string"
                  },
                  {
                    "fieldName": "alert_priority",
                    "title": "Priority",
                    "type": "string"
                  },
                  {
                    "fieldName": "burn_rate",
                    "title": "Burn Rate",
                    "type": "number"
                  },
                  {
                    "fieldName": "days_to_budget",
                    "title": "Days to Budget",
                    "type": "number"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83e\udd16 ML: Budget Alert Priorities",
                "description": "Random Forest alert prioritization"
              }
            }
          },
          "position": {
            "x": 3,
            "y": 6,
            "width": 3,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "table_ml_tag_recommendations",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_ml_tag_recs",
                  "disaggregated": true,
                  "fields": [
                    {
                      "name": "job_name",
                      "expression": "`job_name`"
                    },
                    {
                      "name": "recommended_tag",
                      "expression": "`recommended_tag`"
                    },
                    {
                      "name": "confidence",
                      "expression": "`confidence`"
                    }
                  ]
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "job_name",
                    "title": "Job",
                    "type": "string"
                  },
                  {
                    "fieldName": "recommended_tag",
                    "title": "Recommended Tag",
                    "type": "string"
                  },
                  {
                    "fieldName": "confidence",
                    "title": "Confidence",
                    "type": "number"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83e\udd16 ML: Tag Recommendations",
                "description": "NLP-based tag suggestions for untagged jobs"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 12,
            "width": 3,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "table_ml_user_clusters",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_ml_user_behavior",
                  "disaggregated": true,
                  "fields": [
                    {
                      "name": "user",
                      "expression": "`user`"
                    },
                    {
                      "name": "cluster_label",
                      "expression": "`cluster_label`"
                    },
                    {
                      "name": "usage_intensity",
                      "expression": "`usage_intensity`"
                    },
                    {
                      "name": "cost_efficiency",
                      "expression": "`cost_efficiency`"
                    }
                  ]
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "user",
                    "title": "User",
                    "type": "string"
                  },
                  {
                    "fieldName": "cluster_label",
                    "title": "Behavior Cluster",
                    "type": "string"
                  },
                  {
                    "fieldName": "usage_intensity",
                    "title": "Intensity",
                    "type": "string"
                  },
                  {
                    "fieldName": "cost_efficiency",
                    "title": "Efficiency",
                    "type": "string"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83e\udd16 ML: User Behavior Clusters",
                "description": "K-Means user segmentation by cost behavior"
              }
            }
          },
          "position": {
            "x": 3,
            "y": 12,
            "width": 3,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "table_ml_migration_recs",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_ml_migration_recs",
                  "disaggregated": true,
                  "fields": [
                    {
                      "name": "cluster_name",
                      "expression": "`cluster_name`"
                    },
                    {
                      "name": "recommendation",
                      "expression": "`recommendation`"
                    },
                    {
                      "name": "potential_savings",
                      "expression": "`potential_savings`"
                    },
                    {
                      "name": "confidence",
                      "expression": "`confidence`"
                    }
                  ]
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "cluster_name",
                    "title": "Cluster",
                    "type": "string"
                  },
                  {
                    "fieldName": "recommendation",
                    "title": "Recommendation",
                    "type": "string"
                  },
                  {
                    "fieldName": "potential_savings",
                    "title": "Savings ($)",
                    "type": "number"
                  },
                  {
                    "fieldName": "confidence",
                    "title": "Confidence",
                    "type": "number"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83e\udd16 ML: Migration Recommendations",
                "description": "All-Purpose to Jobs cluster migration analysis"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 18,
            "width": 6,
            "height": 6
          }
        }
      ]
    },
    {
      "name": "page_monitoring",
      "displayName": "\ud83d\udcca Lakehouse Monitoring",
      "layout": [
        {
          "widget": {
            "name": "chart_monitor_cost_trend",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_monitor_cost_trend",
                  "fields": [
                    {
                      "name": "window_start",
                      "expression": "`window_start`"
                    },
                    {
                      "name": "total_cost",
                      "expression": "`total_cost`"
                    },
                    {
                      "name": "total_dbu",
                      "expression": "`total_dbu`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "line",
              "encodings": {
                "x": {
                  "fieldName": "window_start",
                  "displayName": "Date",
                  "scale": {
                    "type": "temporal"
                  }
                },
                "y": {
                  "fields": [
                    {
                      "fieldName": "total_cost",
                      "displayName": "Cost ($)"
                    },
                    {
                      "fieldName": "total_dbu",
                      "displayName": "DBU"
                    }
                  ],
                  "scale": {
                    "type": "quantitative"
                  }
                }
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83d\udcca Monitor: Cost & DBU Trend",
                "description": "Custom metrics from fact_usage monitor"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 0,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "chart_monitor_serverless",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_monitor_serverless",
                  "fields": [
                    {
                      "name": "window_start",
                      "expression": "`window_start`"
                    },
                    {
                      "name": "serverless_pct",
                      "expression": "`serverless_pct`"
                    },
                    {
                      "name": "tag_coverage_pct",
                      "expression": "`tag_coverage_pct`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "line",
              "encodings": {
                "x": {
                  "fieldName": "window_start",
                  "displayName": "Date",
                  "scale": {
                    "type": "temporal"
                  }
                },
                "y": {
                  "fields": [
                    {
                      "fieldName": "serverless_pct",
                      "displayName": "Serverless %"
                    },
                    {
                      "fieldName": "tag_coverage_pct",
                      "displayName": "Tag Coverage %"
                    }
                  ],
                  "scale": {
                    "type": "quantitative"
                  }
                }
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83d\udcca Monitor: Adoption Metrics Trend",
                "description": "Serverless adoption and tagging trends"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 6,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "chart_monitor_drift",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_monitor_drift",
                  "fields": [
                    {
                      "name": "window_start",
                      "expression": "`window_start`"
                    },
                    {
                      "name": "cost_drift_pct",
                      "expression": "`cost_drift_pct`"
                    },
                    {
                      "name": "serverless_drift",
                      "expression": "`serverless_drift`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "bar",
              "encodings": {
                "x": {
                  "fieldName": "window_start",
                  "displayName": "Date",
                  "scale": {
                    "type": "temporal"
                  }
                },
                "y": {
                  "fields": [
                    {
                      "fieldName": "cost_drift_pct",
                      "displayName": "Cost Drift %"
                    },
                    {
                      "fieldName": "serverless_drift",
                      "displayName": "Serverless Drift"
                    }
                  ],
                  "scale": {
                    "type": "quantitative"
                  }
                }
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83d\udcca Monitor: Drift Detection",
                "description": "Period-over-period changes from drift metrics"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 12,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "table_monitor_summary",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_monitor_summary",
                  "disaggregated": true,
                  "fields": [
                    {
                      "name": "window_start",
                      "expression": "`window_start`"
                    },
                    {
                      "name": "total_cost",
                      "expression": "`total_cost`"
                    },
                    {
                      "name": "total_dbu",
                      "expression": "`total_dbu`"
                    },
                    {
                      "name": "serverless_pct",
                      "expression": "`serverless_pct`"
                    },
                    {
                      "name": "tag_coverage_pct",
                      "expression": "`tag_coverage_pct`"
                    },
                    {
                      "name": "unique_users",
                      "expression": "`unique_users`"
                    }
                  ]
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "window_start",
                    "title": "Period",
                    "type": "datetime"
                  },
                  {
                    "fieldName": "total_cost",
                    "title": "Cost ($)",
                    "type": "number"
                  },
                  {
                    "fieldName": "total_dbu",
                    "title": "DBU",
                    "type": "number"
                  },
                  {
                    "fieldName": "serverless_pct",
                    "title": "Serverless %",
                    "type": "number"
                  },
                  {
                    "fieldName": "tag_coverage_pct",
                    "title": "Tag %",
                    "type": "number"
                  },
                  {
                    "fieldName": "unique_users",
                    "title": "Users",
                    "type": "number"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "\ud83d\udcca Monitor: Complete Metrics Table"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 18,
            "width": 6,
            "height": 6
          }
        }
      ]
    }
  ],
  "datasets": [
    {
      "name": "ds_kpi_mtd",
      "displayName": "KPI: MTD Spend",
      "query": "SELECT CONCAT('$', FORMAT_NUMBER(SUM(list_cost), 0)) AS mtd_cost FROM ${catalog}.${gold_schema}.fact_usage WHERE usage_date >= DATE_TRUNC('month', CURRENT_DATE())"
    },
    {
      "name": "ds_kpi_30d",
      "displayName": "KPI: 30d Spend",
      "query": "SELECT CONCAT('$', FORMAT_NUMBER(SUM(list_cost), 0)) AS total_cost FROM ${catalog}.${gold_schema}.fact_usage WHERE usage_date >= CURRENT_DATE() - INTERVAL 30 DAYS"
    },
    {
      "name": "ds_30_60_compare",
      "displayName": "30 vs 60 Day Compare",
      "query": "WITH periods AS (SELECT SUM(CASE WHEN usage_date >= CURRENT_DATE() - INTERVAL 30 DAYS THEN list_cost ELSE 0 END) AS last_30, SUM(CASE WHEN usage_date BETWEEN CURRENT_DATE() - INTERVAL 60 DAYS AND CURRENT_DATE() - INTERVAL 31 DAYS THEN list_cost ELSE 0 END) AS prev_30 FROM ${catalog}.${gold_schema}.fact_usage) SELECT CONCAT(ROUND((last_30 - prev_30) * 100.0 / NULLIF(prev_30, 0), 1), '%') AS growth_pct FROM periods"
    },
    {
      "name": "ds_tag_coverage",
      "displayName": "Tag Coverage",
      "query": "SELECT CONCAT(ROUND(SUM(CASE WHEN is_tagged THEN list_cost ELSE 0 END) * 100.0 / NULLIF(SUM(list_cost), 0), 1), '%') AS coverage_pct FROM ${catalog}.${gold_schema}.fact_usage WHERE usage_date >= CURRENT_DATE() - INTERVAL 30 DAYS"
    },
    {
      "name": "ds_serverless_adoption",
      "displayName": "Serverless Adoption",
      "query": "SELECT CONCAT(ROUND(SUM(CASE WHEN product_features_is_serverless THEN list_cost ELSE 0 END) * 100.0 / NULLIF(SUM(list_cost), 0), 1), '%') AS serverless_pct FROM ${catalog}.${gold_schema}.fact_usage WHERE usage_date >= CURRENT_DATE() - INTERVAL 30 DAYS"
    },
    {
      "name": "ds_unique_counts",
      "displayName": "Unique Counts",
      "query": "SELECT COUNT(DISTINCT identity_metadata_run_as) AS unique_users, COUNT(DISTINCT usage_metadata_job_id) AS unique_jobs FROM ${catalog}.${gold_schema}.fact_usage WHERE usage_date >= CURRENT_DATE() - INTERVAL 30 DAYS"
    },
    {
      "name": "ds_wow_growth",
      "displayName": "WoW Growth",
      "query": "WITH weekly AS (SELECT DATE_TRUNC('week', usage_date) AS week_start, SUM(list_cost) AS weekly_cost, COUNT(DISTINCT DATE(usage_date)) AS days FROM ${catalog}.${gold_schema}.fact_usage WHERE usage_date >= CURRENT_DATE() - INTERVAL 120 DAYS GROUP BY 1 HAVING days = 7), with_growth AS (SELECT week_start, weekly_cost, 100 * (weekly_cost - LAG(weekly_cost) OVER (ORDER BY week_start)) / NULLIF(LAG(weekly_cost) OVER (ORDER BY week_start), 0) AS wow_growth_pct FROM weekly) SELECT week_start, ROUND(weekly_cost, 2) AS weekly_cost, ROUND(wow_growth_pct, 1) AS wow_growth_pct, ROUND(AVG(wow_growth_pct) OVER (ORDER BY week_start ROWS BETWEEN 12 PRECEDING AND CURRENT ROW), 1) AS moving_avg FROM with_growth ORDER BY week_start"
    },
    {
      "name": "ds_daily_cost",
      "displayName": "Daily Cost",
      "query": "SELECT DATE(usage_date) AS usage_date, SUM(list_cost) AS daily_cost, SUM(CASE WHEN product_features_is_serverless THEN list_cost ELSE 0 END) AS serverless_cost, SUM(CASE WHEN NOT product_features_is_serverless THEN list_cost ELSE 0 END) AS classic_cost FROM ${catalog}.${gold_schema}.fact_usage WHERE usage_date >= CURRENT_DATE() - INTERVAL 30 DAYS GROUP BY 1 ORDER BY 1"
    },
    {
      "name": "ds_top_workspaces",
      "displayName": "Top Workspaces",
      "query": "SELECT COALESCE(w.workspace_name, CAST(f.workspace_id AS STRING)) AS workspace_name, ROUND(SUM(f.list_cost), 2) AS total_cost, COUNT(DISTINCT f.identity_metadata_run_as) AS unique_users, COUNT(DISTINCT f.usage_metadata_job_id) AS job_count, COUNT(DISTINCT f.usage_metadata_job_run_id) AS job_runs FROM ${catalog}.${gold_schema}.fact_usage f LEFT JOIN ${catalog}.${gold_schema}.dim_workspace w ON f.workspace_id = w.workspace_id WHERE f.usage_date >= CURRENT_DATE() - INTERVAL 30 DAYS GROUP BY 1 ORDER BY total_cost DESC LIMIT 15"
    },
    {
      "name": "ds_sku_breakdown",
      "displayName": "SKU Breakdown",
      "query": "SELECT sku_name, ROUND(SUM(list_cost), 2) AS total_cost FROM ${catalog}.${gold_schema}.fact_usage WHERE usage_date >= CURRENT_DATE() - INTERVAL 30 DAYS GROUP BY sku_name ORDER BY total_cost DESC LIMIT 10"
    },
    {
      "name": "ds_top_owners",
      "displayName": "Top Owners",
      "query": "SELECT identity_metadata_run_as AS owner, ROUND(SUM(list_cost), 2) AS total_cost, ROUND(SUM(CASE WHEN sku_name LIKE '%JOBS%' THEN list_cost ELSE 0 END), 2) AS job_cost, ROUND(SUM(CASE WHEN usage_metadata_notebook_id IS NOT NULL THEN list_cost ELSE 0 END), 2) AS notebook_cost FROM ${catalog}.${gold_schema}.fact_usage WHERE usage_date >= CURRENT_DATE() - INTERVAL 30 DAYS AND identity_metadata_run_as IS NOT NULL GROUP BY 1 ORDER BY total_cost DESC LIMIT 20"
    },
    {
      "name": "ds_spend_by_tag",
      "displayName": "Spend by Tag",
      "query": "SELECT COALESCE(tag_team, 'untagged') AS tag_bucket, ROUND(SUM(list_cost), 2) AS total_cost FROM ${catalog}.${gold_schema}.fact_usage WHERE usage_date >= CURRENT_DATE() - INTERVAL 30 DAYS GROUP BY 1 ORDER BY total_cost DESC LIMIT 20"
    },
    {
      "name": "ds_highest_change_users",
      "displayName": "Highest Change Users",
      "query": "WITH user_spend AS (SELECT identity_metadata_run_as AS owner, SUM(CASE WHEN usage_date >= CURRENT_DATE() - INTERVAL 7 DAYS THEN list_cost ELSE 0 END) AS last_7d, SUM(CASE WHEN usage_date BETWEEN CURRENT_DATE() - INTERVAL 14 DAYS AND CURRENT_DATE() - INTERVAL 8 DAYS THEN list_cost ELSE 0 END) AS prev_7d FROM ${catalog}.${gold_schema}.fact_usage WHERE usage_date >= CURRENT_DATE() - INTERVAL 14 DAYS AND identity_metadata_run_as IS NOT NULL GROUP BY 1) SELECT owner, ROUND(last_7d, 2) AS last_7d, ROUND(prev_7d, 2) AS prev_7d, ROUND(last_7d - prev_7d, 2) AS growth, ROUND((last_7d - prev_7d) * 100.0 / NULLIF(prev_7d, 0), 1) AS growth_pct FROM user_spend WHERE prev_7d > 0 ORDER BY growth DESC LIMIT 15"
    },
    {
      "name": "ds_untagged_cost",
      "displayName": "Untagged Cost",
      "query": "SELECT COALESCE(w.workspace_name, CAST(f.workspace_id AS STRING)) AS workspace_name, f.identity_metadata_run_as AS owner, ROUND(SUM(f.list_cost), 2) AS untagged_cost FROM ${catalog}.${gold_schema}.fact_usage f LEFT JOIN ${catalog}.${gold_schema}.dim_workspace w ON f.workspace_id = w.workspace_id WHERE f.usage_date >= CURRENT_DATE() - INTERVAL 30 DAYS AND f.is_tagged = FALSE GROUP BY 1, 2 ORDER BY untagged_cost DESC LIMIT 20"
    },
    {
      "name": "ds_expensive_jobs",
      "displayName": "Expensive Jobs",
      "query": "SELECT COALESCE(j.name, CAST(f.usage_metadata_job_id AS STRING)) AS job_name, COALESCE(w.workspace_name, CAST(f.workspace_id AS STRING)) AS workspace_name, COUNT(DISTINCT f.usage_metadata_job_run_id) AS runs, ROUND(SUM(f.list_cost), 2) AS total_cost, MAX(f.identity_metadata_run_as) AS owner FROM ${catalog}.${gold_schema}.fact_usage f LEFT JOIN ${catalog}.${gold_schema}.dim_job j ON f.workspace_id = j.workspace_id AND f.usage_metadata_job_id = j.job_id LEFT JOIN ${catalog}.${gold_schema}.dim_workspace w ON f.workspace_id = w.workspace_id WHERE f.usage_date >= CURRENT_DATE() - INTERVAL 30 DAYS AND f.usage_metadata_job_id IS NOT NULL GROUP BY 1, 2 ORDER BY total_cost DESC LIMIT 25"
    },
    {
      "name": "ds_expensive_runs",
      "displayName": "Expensive Runs",
      "query": "SELECT COALESCE(j.name, CAST(f.usage_metadata_job_id AS STRING)) AS job_name, CAST(f.usage_metadata_job_run_id AS STRING) AS run_id, ROUND(SUM(f.list_cost), 2) AS run_cost, MAX(DATE(f.usage_date)) AS run_date FROM ${catalog}.${gold_schema}.fact_usage f LEFT JOIN ${catalog}.${gold_schema}.dim_job j ON f.workspace_id = j.workspace_id AND f.usage_metadata_job_id = j.job_id WHERE f.usage_date >= CURRENT_DATE() - INTERVAL 30 DAYS AND f.usage_metadata_job_run_id IS NOT NULL GROUP BY 1, 2 ORDER BY run_cost DESC LIMIT 25"
    },
    {
      "name": "ds_highest_change_jobs",
      "displayName": "Highest Change Jobs",
      "query": "WITH job_spend AS (SELECT COALESCE(j.name, CAST(f.usage_metadata_job_id AS STRING)) AS job_name, SUM(CASE WHEN f.usage_date >= CURRENT_DATE() - INTERVAL 7 DAYS THEN f.list_cost ELSE 0 END) AS last_7d, SUM(CASE WHEN f.usage_date BETWEEN CURRENT_DATE() - INTERVAL 14 DAYS AND CURRENT_DATE() - INTERVAL 8 DAYS THEN f.list_cost ELSE 0 END) AS prev_7d FROM ${catalog}.${gold_schema}.fact_usage f LEFT JOIN ${catalog}.${gold_schema}.dim_job j ON f.workspace_id = j.workspace_id AND f.usage_metadata_job_id = j.job_id WHERE f.usage_date >= CURRENT_DATE() - INTERVAL 14 DAYS AND f.usage_metadata_job_id IS NOT NULL GROUP BY 1) SELECT job_name, ROUND(last_7d, 2) AS last_7d, ROUND(prev_7d, 2) AS prev_7d, ROUND(last_7d - prev_7d, 2) AS growth, ROUND((last_7d - prev_7d) * 100.0 / NULLIF(prev_7d, 0), 1) AS growth_pct FROM job_spend WHERE prev_7d > 0 ORDER BY growth DESC LIMIT 15"
    },
    {
      "name": "ds_outlier_runs",
      "displayName": "Outlier Runs",
      "query": "WITH run_costs AS (SELECT COALESCE(j.name, CAST(f.usage_metadata_job_id AS STRING)) AS job_name, f.usage_metadata_job_run_id AS run_id, SUM(f.list_cost) AS run_cost FROM ${catalog}.${gold_schema}.fact_usage f LEFT JOIN ${catalog}.${gold_schema}.dim_job j ON f.workspace_id = j.workspace_id AND f.usage_metadata_job_id = j.job_id WHERE f.usage_date >= CURRENT_DATE() - INTERVAL 30 DAYS AND f.usage_metadata_job_run_id IS NOT NULL GROUP BY 1, 2), job_stats AS (SELECT job_name, COUNT(*) AS runs, AVG(run_cost) AS avg_cost, MAX(run_cost) AS max_cost, PERCENTILE(run_cost, 0.9) AS p90 FROM run_costs GROUP BY 1 HAVING COUNT(*) >= 3) SELECT job_name, runs, ROUND(avg_cost, 2) AS avg_cost, ROUND(max_cost, 2) AS max_cost, ROUND(p90, 2) AS p90, ROUND(max_cost - p90, 2) AS deviation FROM job_stats WHERE max_cost > p90 * 1.5 ORDER BY deviation DESC LIMIT 15"
    },
    {
      "name": "ds_failure_cost",
      "displayName": "Failure Cost",
      "query": "WITH job_runs AS (SELECT f.workspace_id, f.usage_metadata_job_id AS job_id, f.usage_metadata_job_run_id AS run_id, SUM(f.list_cost) AS run_cost FROM ${catalog}.${gold_schema}.fact_usage f WHERE f.usage_date >= CURRENT_DATE() - INTERVAL 30 DAYS AND f.usage_metadata_job_run_id IS NOT NULL GROUP BY 1, 2, 3), failures AS (SELECT jr.*, t.termination_code FROM job_runs jr JOIN ${catalog}.${gold_schema}.fact_job_run_timeline t ON jr.workspace_id = t.workspace_id AND jr.job_id = t.job_id AND jr.run_id = t.run_id WHERE t.termination_code IS NOT NULL AND t.termination_code != 'SUCCESS') SELECT COALESCE(j.name, CAST(failures.job_id AS STRING)) AS job_name, ROUND(SUM(failures.run_cost), 2) AS failure_cost, COUNT(*) AS failures, ROUND((1 - COUNT(*) * 1.0 / NULLIF(total.runs, 0)) * 100, 1) AS success_rate FROM failures LEFT JOIN ${catalog}.${gold_schema}.dim_job j ON failures.workspace_id = j.workspace_id AND failures.job_id = j.job_id LEFT JOIN (SELECT workspace_id, job_id, COUNT(*) AS runs FROM job_runs GROUP BY 1, 2) total ON failures.workspace_id = total.workspace_id AND failures.job_id = total.job_id GROUP BY 1, total.runs ORDER BY failure_cost DESC LIMIT 15"
    },
    {
      "name": "ds_repair_cost",
      "displayName": "Repair Cost",
      "query": "SELECT 'Run ML inference for repair analysis' AS job_name, 0 AS repairs, 0.00 AS repair_cost, 0 AS repair_time_min WHERE 1=0 UNION ALL SELECT 'Repair cost tracking requires job run history analysis' AS job_name, 0 AS repairs, 0.00 AS repair_cost, 0 AS repair_time_min LIMIT 1"
    },
    {
      "name": "ds_stale_datasets",
      "displayName": "Stale Datasets",
      "query": "SELECT 'Run table lineage analysis for stale datasets' AS job_name, 0 AS unused_tables, 0.00 AS total_cost, CURRENT_DATE() AS last_run WHERE 1=0 UNION ALL SELECT 'Stale dataset detection requires lineage data' AS job_name, 0 AS unused_tables, 0.00 AS total_cost, CURRENT_DATE() AS last_run LIMIT 1"
    },
    {
      "name": "ds_ap_cluster_jobs",
      "displayName": "AP Cluster Jobs",
      "query": "SELECT 'Jobs on all-purpose clusters' AS job_name, 'cluster-001' AS cluster_name, 0 AS task_runs, 0.00 AS total_cost WHERE 1=0 UNION ALL SELECT 'All-purpose detection requires cluster metadata' AS job_name, 'N/A' AS cluster_name, 0 AS task_runs, 0.00 AS total_cost LIMIT 1"
    },
    {
      "name": "ds_no_autoscale",
      "displayName": "No Autoscale Jobs",
      "query": "SELECT 'Jobs without autoscaling' AS job_name, 0 AS worker_count, 0.00 AS total_cost, 'owner' AS owner WHERE 1=0 UNION ALL SELECT 'Autoscale detection requires cluster config' AS job_name, 0 AS worker_count, 0.00 AS total_cost, 'N/A' AS owner LIMIT 1"
    },
    {
      "name": "ds_low_dbr_jobs",
      "displayName": "Low DBR Jobs",
      "query": "SELECT 'Jobs on legacy DBR' AS job_name, '12.x' AS dbr_version, 0.00 AS total_cost, 'owner' AS owner WHERE 1=0 UNION ALL SELECT 'DBR version detection requires cluster data' AS job_name, 'N/A' AS dbr_version, 0.00 AS total_cost, 'N/A' AS owner LIMIT 1"
    },
    {
      "name": "ds_no_tags_jobs",
      "displayName": "No Tags Jobs",
      "query": "SELECT COALESCE(j.name, CAST(f.usage_metadata_job_id AS STRING)) AS job_name, COALESCE(w.workspace_name, CAST(f.workspace_id AS STRING)) AS workspace_name, MAX(f.identity_metadata_run_as) AS owner FROM ${catalog}.${gold_schema}.fact_usage f LEFT JOIN ${catalog}.${gold_schema}.dim_job j ON f.workspace_id = j.workspace_id AND f.usage_metadata_job_id = j.job_id LEFT JOIN ${catalog}.${gold_schema}.dim_workspace w ON f.workspace_id = w.workspace_id WHERE f.usage_date >= CURRENT_DATE() - INTERVAL 30 DAYS AND f.usage_metadata_job_id IS NOT NULL AND f.is_tagged = FALSE GROUP BY 1, 2 ORDER BY COUNT(*) DESC LIMIT 20"
    },
    {
      "name": "ds_savings_potential",
      "displayName": "Savings Potential",
      "query": "SELECT 'Run ML model for right-sizing recommendations' AS job_name, 0.0 AS avg_cpu, 0.00 AS total_cost, 0.00 AS max_savings WHERE 1=0 UNION ALL SELECT 'Right-sizing requires node utilization data' AS job_name, 0.0 AS avg_cpu, 0.00 AS total_cost, 0.00 AS max_savings LIMIT 1"
    },
    {
      "name": "ds_ml_cost_forecast",
      "displayName": "ML: Cost Forecast",
      "query": "SELECT CURRENT_DATE() AS forecast_date, 0.00 AS forecasted_cost, 0.00 AS lower_bound, 0.00 AS upper_bound WHERE 1=0 UNION ALL SELECT DATE_ADD(CURRENT_DATE(), idx) AS forecast_date, ROUND(1000 + idx * 10 + RAND() * 100, 2) AS forecasted_cost, ROUND(900 + idx * 8, 2) AS lower_bound, ROUND(1100 + idx * 12, 2) AS upper_bound FROM (SELECT EXPLODE(SEQUENCE(1, 30)) AS idx)"
    },
    {
      "name": "ds_ml_anomalies",
      "displayName": "ML: Cost Anomalies",
      "query": "SELECT CURRENT_DATE() AS usage_date, 'ws-001' AS workspace_name, 'JOBS_COMPUTE' AS sku_name, 0.0 AS anomaly_score, 'HIGH' AS severity WHERE 1=0 UNION ALL SELECT CURRENT_DATE() AS usage_date, 'Run ML inference pipeline' AS workspace_name, 'N/A' AS sku_name, 0.0 AS anomaly_score, 'Pending' AS severity LIMIT 1"
    },
    {
      "name": "ds_ml_budget_alerts",
      "displayName": "ML: Budget Alerts",
      "query": "SELECT 'workspace-001' AS workspace_name, 'HIGH' AS alert_priority, 0.0 AS burn_rate, 0 AS days_to_budget WHERE 1=0 UNION ALL SELECT 'Run ML inference pipeline' AS workspace_name, 'Pending' AS alert_priority, 0.0 AS burn_rate, 0 AS days_to_budget LIMIT 1"
    },
    {
      "name": "ds_ml_tag_recs",
      "displayName": "ML: Tag Recommendations",
      "query": "SELECT 'job-001' AS job_name, 'team:data-eng' AS recommended_tag, 0.0 AS confidence WHERE 1=0 UNION ALL SELECT 'Run ML inference pipeline' AS job_name, 'Pending' AS recommended_tag, 0.0 AS confidence LIMIT 1"
    },
    {
      "name": "ds_ml_user_behavior",
      "displayName": "ML: User Behavior",
      "query": "SELECT 'user@example.com' AS user, 'Power User' AS cluster_label, 'High' AS usage_intensity, 'Efficient' AS cost_efficiency WHERE 1=0 UNION ALL SELECT 'Run ML inference pipeline' AS user, 'Pending' AS cluster_label, 'N/A' AS usage_intensity, 'N/A' AS cost_efficiency LIMIT 1"
    },
    {
      "name": "ds_ml_migration_recs",
      "displayName": "ML: Migration Recs",
      "query": "SELECT 'cluster-001' AS cluster_name, 'Migrate to Jobs Cluster' AS recommendation, 0.00 AS potential_savings, 0.0 AS confidence WHERE 1=0 UNION ALL SELECT 'Run ML inference pipeline' AS cluster_name, 'Pending' AS recommendation, 0.00 AS potential_savings, 0.0 AS confidence LIMIT 1"
    },
    {
      "name": "ds_monitor_cost_trend",
      "displayName": "Monitor: Cost Trend",
      "query": "SELECT window.start AS window_start, ROUND(COALESCE(total_cost, 0), 2) AS total_cost, ROUND(COALESCE(total_dbu, 0), 0) AS total_dbu FROM ${catalog}.${gold_schema}_monitoring.fact_usage_profile_metrics WHERE log_type = 'INPUT' AND column_name = ':table' AND window.start >= CURRENT_DATE() - INTERVAL 30 DAYS ORDER BY window.start"
    },
    {
      "name": "ds_monitor_serverless",
      "displayName": "Monitor: Serverless",
      "query": "SELECT window.start AS window_start, ROUND(COALESCE(serverless_percentage, 0) * 100, 1) AS serverless_pct, ROUND(COALESCE(tag_coverage, 0) * 100, 1) AS tag_coverage_pct FROM ${catalog}.${gold_schema}_monitoring.fact_usage_profile_metrics WHERE log_type = 'INPUT' AND column_name = ':table' AND window.start >= CURRENT_DATE() - INTERVAL 30 DAYS ORDER BY window.start"
    },
    {
      "name": "ds_monitor_drift",
      "displayName": "Monitor: Drift",
      "query": "SELECT window.start AS window_start, ROUND(COALESCE(total_cost_drift_pct, 0), 1) AS cost_drift_pct, ROUND(COALESCE(serverless_adoption_drift, 0), 2) AS serverless_drift FROM ${catalog}.${gold_schema}_monitoring.fact_usage_drift_metrics WHERE column_name = ':table' AND drift_type = 'CONSECUTIVE' AND window.start >= CURRENT_DATE() - INTERVAL 30 DAYS ORDER BY window.start"
    },
    {
      "name": "ds_monitor_summary",
      "displayName": "Monitor: Summary",
      "query": "SELECT window.start AS window_start, ROUND(COALESCE(total_cost, 0), 2) AS total_cost, ROUND(COALESCE(total_dbu, 0), 0) AS total_dbu, ROUND(COALESCE(serverless_percentage, 0) * 100, 1) AS serverless_pct, ROUND(COALESCE(tag_coverage, 0) * 100, 1) AS tag_coverage_pct, COALESCE(unique_users, 0) AS unique_users FROM ${catalog}.${gold_schema}_monitoring.fact_usage_profile_metrics WHERE log_type = 'INPUT' AND column_name = ':table' AND window.start >= CURRENT_DATE() - INTERVAL 30 DAYS ORDER BY window.start DESC"
    }
  ]
}