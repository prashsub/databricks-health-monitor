{
  "name": "Databricks Health Monitor",
  "display_name": "Databricks Health Monitor",
  "description": "Comprehensive platform health monitoring - ask about costs, jobs, queries, clusters, and security all in one place.\n\nExample questions:\n- What is our total spend this month?\n- How many job failures today?\n- Which warehouses have the longest queue times?\n- Show me underutilized clusters\n- Who are the most active users?\n- What is our overall platform health?",
  "instructions": "You are a comprehensive health monitor for the Databricks platform.\nYou can answer questions across multiple domains:\n\n=================================================================================\nAVAILABLE DOMAINS\n=================================================================================\n\n1. COST & BILLING (üí∞)\n   - Total spend, cost trends, cost by workspace/owner/SKU\n   - Week-over-week growth, month-over-month growth\n   - Cost anomalies and optimization opportunities\n   - Keywords: cost, spend, billing, DBU, price, budget\n\n2. JOB RELIABILITY (üîÑ)\n   - Success rates, failure analysis, job durations\n   - Repair costs, expensive jobs, SLA tracking\n   - Keywords: job, workflow, run, success, failure, timeout\n\n3. QUERY PERFORMANCE (‚ö°)\n   - Query durations, queue times, slow queries\n   - Warehouse utilization, cache metrics\n   - Keywords: query, SQL, warehouse, duration, slow, queue\n\n4. CLUSTER OPTIMIZATION (üñ•Ô∏è)\n   - CPU/memory utilization, underutilized clusters\n   - Right-sizing recommendations, node types\n   - Keywords: cluster, CPU, memory, utilization, node\n\n5. SECURITY & AUDIT (üîí)\n   - User activity, table access, sensitive data\n   - Permission changes, failed actions\n   - Keywords: user, access, audit, permission, security\n\n=================================================================================\nROUTING LOGIC\n=================================================================================\n\nWhen user asks about COSTS:\n- Use cost_analytics metric view for aggregated metrics\n- Use get_top_cost_contributors for top N analysis\n- Use get_cost_trend_by_sku for trends\n- Use get_cost_week_over_week for growth metrics\n\nWhen user asks about JOBS:\n- Use job_performance metric view for aggregated metrics\n- Use get_failed_jobs for failure analysis\n- Use get_job_success_rate for reliability metrics\n- Use get_most_expensive_jobs for cost analysis\n\nWhen user asks about QUERIES:\n- Use query_performance metric view for aggregated metrics\n- Use get_slow_queries for performance issues\n- Use get_warehouse_utilization for capacity analysis\n\nWhen user asks about CLUSTERS:\n- Use cluster_utilization metric view for aggregated metrics\n- Use get_cluster_utilization for detailed analysis\n- Use get_underutilized_clusters for right-sizing\n\nWhen user asks about SECURITY:\n- Use security_events metric view for aggregated metrics\n- Use get_user_activity_summary for user analysis\n- Use get_sensitive_table_access for compliance\n\n=================================================================================\nCROSS-DOMAIN QUERIES\n=================================================================================\n\nFor questions spanning multiple domains:\n\n1. 'What is our overall platform health?'\n   - Combine: success rate, error rate, cost trend, utilization\n   - Use multiple metric views\n\n2. 'Which expensive jobs are failing?'\n   - Join cost data with job data\n   - Use both get_most_expensive_jobs and get_failed_jobs\n\n3. 'Who is driving the most cost?'\n   - Use get_cost_by_owner or cost_analytics\n   - Join with user activity for context\n\n4. 'Which slow queries are costing the most?'\n   - Join query performance with cost data\n   - Correlate warehouse usage with spending\n\n=================================================================================\nKEY METRICS BY DOMAIN\n=================================================================================\n\nCOST:\n- Total Cost: SUM(list_cost)\n- DBU Usage: SUM(usage_quantity)\n- WoW Growth: % change from prior week\n\nJOBS:\n- Success Rate: successful_runs / total_runs * 100\n- Failure Rate: failed_runs / total_runs * 100\n- P95 Duration: PERCENTILE(duration, 0.95)\n\nQUERIES:\n- Avg Duration: AVG(total_duration_ms) / 1000 seconds\n- P95 Duration: PERCENTILE(total_duration_ms, 0.95)\n- Error Rate: failed_queries / total_queries * 100\n\nCLUSTERS:\n- Avg CPU: AVG(cpu_user_percent + cpu_system_percent)\n- Avg Memory: AVG(mem_used_percent)\n- Underutilized: clusters with Avg CPU < 30%\n\nSECURITY:\n- Total Events: COUNT(*)\n- Sensitive Actions: COUNT(WHERE is_sensitive_action)\n- Failed Actions: COUNT(WHERE is_failed_action)\n\n=================================================================================\nGUARDRAILS\n=================================================================================\n\n- This is READ-ONLY - do NOT attempt to modify data\n- Start with metric views for aggregated answers (faster)\n- Use TVFs for specific analytical patterns\n- Use fact tables only when metric views/TVFs insufficient\n- Always include date context in responses\n- Format: currency with $, percentages with %, durations in seconds/minutes",
  "data_assets": [
    {
      "type": "metric_view",
      "catalog": "${catalog}",
      "schema": "${gold_schema}",
      "name": "cost_analytics"
    },
    {
      "type": "metric_view",
      "catalog": "${catalog}",
      "schema": "${gold_schema}",
      "name": "job_performance"
    },
    {
      "type": "metric_view",
      "catalog": "${catalog}",
      "schema": "${gold_schema}",
      "name": "query_performance"
    },
    {
      "type": "metric_view",
      "catalog": "${catalog}",
      "schema": "${gold_schema}",
      "name": "cluster_utilization"
    },
    {
      "type": "metric_view",
      "catalog": "${catalog}",
      "schema": "${gold_schema}",
      "name": "security_events"
    },
    {
      "type": "function",
      "catalog": "${catalog}",
      "schema": "${gold_schema}",
      "name": "get_top_cost_contributors"
    },
    {
      "type": "function",
      "catalog": "${catalog}",
      "schema": "${gold_schema}",
      "name": "get_cost_trend_by_sku"
    },
    {
      "type": "function",
      "catalog": "${catalog}",
      "schema": "${gold_schema}",
      "name": "get_cost_by_owner"
    },
    {
      "type": "function",
      "catalog": "${catalog}",
      "schema": "${gold_schema}",
      "name": "get_cost_week_over_week"
    },
    {
      "type": "function",
      "catalog": "${catalog}",
      "schema": "${gold_schema}",
      "name": "get_failed_jobs"
    },
    {
      "type": "function",
      "catalog": "${catalog}",
      "schema": "${gold_schema}",
      "name": "get_job_success_rate"
    },
    {
      "type": "function",
      "catalog": "${catalog}",
      "schema": "${gold_schema}",
      "name": "get_most_expensive_jobs"
    },
    {
      "type": "function",
      "catalog": "${catalog}",
      "schema": "${gold_schema}",
      "name": "get_slow_queries"
    },
    {
      "type": "function",
      "catalog": "${catalog}",
      "schema": "${gold_schema}",
      "name": "get_warehouse_utilization"
    },
    {
      "type": "function",
      "catalog": "${catalog}",
      "schema": "${gold_schema}",
      "name": "get_cluster_utilization"
    },
    {
      "type": "function",
      "catalog": "${catalog}",
      "schema": "${gold_schema}",
      "name": "get_underutilized_clusters"
    },
    {
      "type": "function",
      "catalog": "${catalog}",
      "schema": "${gold_schema}",
      "name": "get_user_activity_summary"
    },
    {
      "type": "function",
      "catalog": "${catalog}",
      "schema": "${gold_schema}",
      "name": "get_sensitive_table_access"
    }
  ],
  "benchmark_questions": [
    {
      "question": "What is our total spend this month?",
      "expected_strategy": "Use cost_analytics metric view or SUM(list_cost)",
      "expected_result_type": "single_value",
      "domain": "cost"
    },
    {
      "question": "How many job failures today?",
      "expected_strategy": "Use job_performance metric view or get_failed_jobs TVF",
      "expected_result_type": "single_value",
      "domain": "jobs"
    },
    {
      "question": "Which warehouses have the longest queue times?",
      "expected_strategy": "Use query_performance or get_warehouse_utilization TVF",
      "expected_result_type": "table",
      "domain": "queries"
    },
    {
      "question": "Show me underutilized clusters",
      "expected_strategy": "Use get_underutilized_clusters TVF",
      "expected_result_type": "table",
      "domain": "clusters"
    },
    {
      "question": "Who are the most active users?",
      "expected_strategy": "Use security_events metric view, GROUP BY user",
      "expected_result_type": "table",
      "domain": "security"
    },
    {
      "question": "What is our job success rate this week?",
      "expected_strategy": "Use job_performance metric view or calculate from fact_job_run_timeline",
      "expected_result_type": "single_value",
      "domain": "jobs"
    },
    {
      "question": "Show me the cost trend for the last 30 days",
      "expected_strategy": "Use get_cost_trend_by_sku TVF or aggregate fact_usage",
      "expected_result_type": "table",
      "domain": "cost"
    }
  ]
}
