# Gold Layer Table Schema
# Table: fact_payload_logs
# Domain: model_serving
# Bronze Source: __internal_logging.payload_logs
# Generated with: Enhanced LLM-friendly descriptions

table_name: fact_payload_logs
domain: model_serving
bronze_source: __internal_logging.payload_logs

description: >
  Fact table storing AI Gateway request/response payloads.
  Business: GenAI observability - captures prompts, completions, token usage, and latency
  for external LLM calls. Essential for AI cost monitoring, quality assurance, and
  debugging model behavior. Technical: From AI Gateway payload logging.

primary_key:
  columns: ['databricks_request_id']
  composite: False

foreign_keys:
  - columns: ['workspace_id']
    references: dim_workspace(workspace_id)
    nullable: True

  - columns: ['served_entity_id']
    references: dim_served_entity(served_entity_id)
    nullable: True

columns:
  - name: account_id
    type: STRING
    nullable: true
    description: "Account identifier. Business: Top-level organizational entity for Databricks deployment, used for account-wide cost rollups, security auditing, and multi-workspace governance. Essential for enterprise billing reconciliation and compliance reporting. Technical: Globally unique STRING identifier from Databricks account management, typically references external billing system. May be nullable in w..."

  - name: workspace_id
    type: STRING
    nullable: true
    description: "Workspace identifier. Business: Links usage, jobs, queries, and compute to specific Databricks workspace for cost allocation and resource tracking. Critical for multi-workspace environments enabling workspace-level filtering, reporting, and governance. Primary dimension for organizational cost attribution. Technical: Globally unique STRING identifier from Databricks control plane, foreign key t..."

  - name: request_date
    type: DATE
    nullable: true
    description: "The UTC date on which the model serving request was received. Business: Used for temporal analysis, trend tracking, and time-based filtering. Critical for historical reporting and time-series analytics. Technical: Sourced from Bronze layer. DATE type."

  - name: databricks_request_id
    type: STRING
    nullable: false
    description: "A Databricks generated request identifier attached to all model serving requests. Business: Used for unique identification, tracking, and cross-system correlation. Essential for joins and dimensional analysis. Technical: Sourced from Bronze layer. STRING type."

  - name: client_request_id
    type: STRING
    nullable: true
    description: "The user-provided request identifier that can be specified in the model serving request body. Business: Used for unique identification, tracking, and cross-system correlation. Essential for joins and dimensional analysis. Technical: Sourced from Bronze layer. STRING type."

  - name: request_time
    type: TIMESTAMP
    nullable: true
    description: "The timestamp at which the request is received. Business: Used for temporal analysis, trend tracking, and time-based filtering. Critical for historical reporting and time-series analytics. Technical: Sourced from Bronze layer. TIMESTAMP type."

  - name: status_code
    type: INT
    nullable: true
    description: "The HTTP status code that was returned from the model. Business: Provides essential context for analytics and operational reporting. Used for filtering, grouping, and drill-down analysis. Technical: Sourced from Bronze layer. INT type."

  - name: sampling_fraction
    type: DOUBLE
    nullable: true
    description: "The sampling fraction used in the event that the request was down-sampled. This value is between 0 and 1, where 1 represents that 100% of incoming requests were included. Business: Provides essential context for analytics and operational reporting. Used for filtering, grouping, and drill-down analysis. Technical: Sourced from Bronze layer. DOUBLE type."

  - name: execution_duration_ms
    type: BIGINT
    nullable: true
    description: "The time in milliseconds for which the model performed inference. This does not include overhead network latencies and only represents the time it took for the model to generate predictions. Business: Provides essential context for analytics and operational reporting. Used for filtering, grouping, and drill-down analysis. Technical: Sourced from Bronze layer. BIGINT type."

  - name: request
    type: STRING
    nullable: true
    description: "The raw request JSON body that was sent to the model serving endpoint. Business: Provides essential context for analytics and operational reporting. Used for filtering, grouping, and drill-down analysis. Technical: Sourced from Bronze layer. STRING type."

  - name: response
    type: STRING
    nullable: true
    description: "The raw response JSON body that was returned by the model serving endpoint. Business: Provides essential context for analytics and operational reporting. Used for filtering, grouping, and drill-down analysis. Technical: Sourced from Bronze layer. STRING type."

  - name: served_entity_id
    type: STRING
    nullable: true
    description: "The unique ID of the served entity. Business: Used for unique identification, tracking, and cross-system correlation. Essential for joins and dimensional analysis. Technical: Sourced from Bronze layer. STRING type."

  - name: endpoint_table_id
    type: STRING
    nullable: true
    description: "ID of the individual customer owned inference table / application system table. Business: Used for unique identification, tracking, and cross-system correlation. Essential for joins and dimensional analysis. Technical: Sourced from Bronze layer. STRING type."

  - name: requester
    type: STRING
    nullable: true
    description: "The ID of the user or service principal whose permissions are used for the invocation request of the serving endpoint. This field returns NULL for route-optimized custom model endpoints. Business: Provides essential context for analytics and operational reporting. Used for filtering, grouping, and drill-down analysis. Technical: Sourced from Bronze layer. STRING type."

  # === Flattened Nested Columns ===

  - name: logging_error_codes_json
    type: STRING
    nullable: true
    description: "The errors that occurred when the data could not be logged. Error codes include MAX_REQUEST_SIZE_EXCEEDED and MAX_RESPONSE_SIZE_EXCEEDED. Stored as JSON ARRAY. Business: Preserves list/map structure for detailed analysis. Query using array/map SQL functions or JSON parsing. Technical: STRING type containing JSON-serialized ARRAY, enables flexible querying of variable-length collections."

